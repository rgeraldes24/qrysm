package util

import (
	"bytes"
	"encoding/hex"
	"testing"

	"github.com/theQRL/qrysm/config/params"
	"github.com/theQRL/qrysm/testing/require"
	"google.golang.org/protobuf/proto"
)

func TestSetupInitialDeposits_1024Entries(t *testing.T) {
	entries := 1
	resetCache()
	deposits, privKeys, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err := DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	expectedPublicKeyAt0 := []byte("2e3bcd95f5e30d0b7c5577b66c6373c567a6151ea39a75e477fb9b979276efac8952fcab3b1e671c1903063c08de679ae4fdda1e3f2cf675364a0f9fa5cebb7a6d69dfd6fd5b060dce52f19c3d95337ed388b53ea8d9340860cdfe449187d617e072979f84d7c9bc1a7169706b6fbe01e51c6c8117be3d61e79c046827d095a6f88d4c452da251910d34c7e77e773d667db344535b71998d33920d21d03f16c8b60d27448d24dbe239771bb312be22ef881e919a8bb2cf63108d6122f1ccdd3dce3ccc39a4bf06bfc8acdfeac9261cb061b64e1210dbd70d1da94145fb46e114fd61111c7e28f96a8023b4b3d2b705e347d9d5f629e0c64a533eaf0a84095ccb609196b768d1212db3d957fbf5df67fc8a14c72fba9659ae677647c24dd9d121094ac1cac39f14fbbe5e8624808f004e970b3530c5118cfbb1f041308eba8c8a5bec6ac20805790eb793c21eed3908c0ee74075ebe0f8367d46341f548326a9dfe96dc237a7e103010c5810472d071dc86a3f12936e8f3181eb8de498719acafe20cd59f8291b0313fa70f9843fa65a49712e92516accbb9d2c30c341b5341d618db57299937b7bbd7d51ee9b5e1329cfd725988ad4d8f01389497bfcfe904bbebfd69e9adaf1afa15136f2fe355d4e54aa4c21a4c41bf1a9172535504058d7aaceb9776f16e5c209204b755de6a978cc9952d4bf45b24718cab949e198fef31bc14a09f8474ee0037b758bfb952f5bf0a5f2231c02dcded4c85600a447b80ffd39d6a07c9dedd7efdd45b9c855d9a9b6a88f1f14f405a7608c1f64cd815df316a3ad8442b75df79aade1a9156eb917ad18251406a277cf38f9870a7902b4422931d73406f87e0802e96965773935d2639a649863198d83946425c40a84413d2b1bca109573dc6298584b8c589373be2ca7732478b220b1a214182f96a26c5a1b45dda66d2385346301d167d30202b4fa6167cfb87ecf0377d33a7cac6f38b29ff384481c4531e47a94197334e8ff9f77eb868813f9d5ba5249d9006a2317397cafdd206375d9654eceff93115a530e84ae55a7a25d02d44d737f42da58486c7dc3e92f3312ca80dfe2a9e87a52c6cfd852fb23767a9e551455ce7f2629855cc28c56e83cd6f2e1d4e3f05058b6a748fcdce270decc01149d96a9ab1f4f8ac1c72742f4fb0f602144e018697134d9ed2a5771bba1a8702ce94fc1732299080616348bb6eeaf7ed985e881f0a2a407b22e3a8426d4a4e2ceb257d4e635cb12c1706edc0fc77043652f3ccf3afa7d2b97c3b60bd0078d7220de39fd1e822e37c6827b870d1ce431015b03b1c8e2e88283bd8d7c6ca88673f7141d88c702d4f2bb35aa8f953249f429d7f80a67ed4352d5b2b79694f545f89d23e7e4a96c98647236c55bfe2d02f1fcfa254f9089baef4a5c8b9ecf5936cd6102500d67993ed92143dfca9c60caf49b25096c79bb9661839032507f99e8770702fa74babffe16da6b4c66fdf47e9fa03321ec973582dc4492c3025254037f55bfd47bed448105445ff7d9f0b2fbb84d798151c6d1255982dceda6abe534c1a487b9f0a2669faddce68840651c57daa54664e2dc11084867d98687a17758ddacbf0b2088e46f1c87deda65a904020c187e26fb22053aaa4daea57caaf9df6119909e727447d483492c961f72918e4dd8a7e543aa490b39c1f45e05b22f3e9023bbcadf0f91b3fdab1ac16aae2d6f13729219d5ae70b2ba8b552f23a25e56bad561d06c3c33a6578a966b9a9e8971c6008ad5791cd87ab2da27690b3f2868191a65abb6add5f72613a6ba333b1cbdea995cad79007eacc931061cb6c107b55973a87d15bc9c95d2d9e4dec237ddf91672251a05853dc97fe3ed27196814cb6e84f1e28954693475d382b6ec7ddb594613325d2c82a7dd9bb6a429ee0037cd8af2f129d871eef4da33966edecd011f0d271e527fb694430833bd7acc3b2944599ba3e13aae3a1213bf265dccd53123b8b285d9158d072699fc8c68d461550abe4794ff7397d1fc1adde7502be6e93399cc5ca0963d38be6923b033c6873b9ce8d05c0de899fb116ffd20822d8d956d1dcdc823f5b3682cb12491d462c1d98600f2b48ad02ba7090e2833c8b8f374229074d21f13b3d9c0923f78624e8fe2caa8ec57d7b321494d796f742e93c9e049cb416b05a17eeba52799113cb42274ea07fa7fb8405f5ea726eebcf15da0173c344f7f85da412589dd30c9a9b858e1cb3d36fdf3bbe988ff83ecbcaae06a40a7cde8225b5e02edd615a0c89126bead1380a4c8843ad313cb94b040dbda8a354dd11e2725584d500fb61adb7f785f253e153998838e5b87374f1c759e48da79f1d3e44c3c0c0ac3b13473abad9cfdf60f5b572387c7bebaa4a419d8a0cd26e73ec58ea92f80de3f9aca31f1faedf94d82b2b35f2520d4f6167c6e886f84620d79d7d8859f8562bff408f7fb3bea11c3ffdd8074748e10b22ed1bb5955daf6122c8daeafa5541364845f149c67ff83a0f8517fc6727b4c997d637c3c46bf80c76e9e8858ea041cbfee49fc135fe8ef082fab0dcb9c795f81add8e0d7386bb2cee496948b9c8bd22d3230d400b0beb119297097a73e41760df8ae3f22ab40d0402238833c5e12d90fecb1ce9c88c68f281baaef15cdadcdad4670ab0dec84b14adb9c0325fc63a05bc66fbff3bdf45a114f42c232ff53d8bfb3a474ce5c4f71841ee198336d4eeec82d52df5c4098f25bcc88f894a091cfc63203d3d50b5d456143467018da3795ee9d84508027a503550a813be30a3151bc1ca3768307d381e9184df8a3d00b20cedde0d82a728e2e714d1461deefa6acc067397ce836500289b57ac535aa19317dcf27c20460803ba777e55b8e29b9a678b67c6d6ef7abb82fdf976ef56eff535664dc28ec94b8b78193843be5ff58c2180b9559fb14749e9b7139d83fe2cf9fb375f134dc51e79831d932aefac40aeb83e006679952f95820882de19027172822cd6365be331fc7a54bfea837277410c0f81362518967dbafab318c820212ec5515b4e7354d15815c080a52f31553a5e9081bfc38ce19ef227fde8e05d042146b2dfe0bd4cfcf927b73cf3472ea8718d7d4c62753353ce24e64f7cb330257498a44260d92e64968e3d89a55c33a93dbe1df6220abbdf6f675febc8bba04e3145fb61ad6f766625535826681ae969635b55f12220339d5fb644dbd9ba8b00d0a4c28b58ccb7df5eec10b93472ed0fe31f1d22be4848ef8b0e70c636a19ff2770fe5e7ee691fbc44820b71cc826a5a4d3995015a26f31ce0d0e2512d29705ff15a1faf7d88c45c7d67c10f5d38672ac69c2442cdb602de3f8553b077c07e39a3fa09a4588667b766133b402da1a77bcaf6eb2df58cd9b445e9eb1537654aff9e8c882e2a1a3e5ed46efb782515c0500056c422994cf8f18edd8c4422944a7fe16c1a59c2e098cdd7afc965af691f582142470953c0fc2e3a9ff2b8c87e483d1c811ce3a92a20341e7c1ead94448cbd49121d96258c657add51d9bfbf10b28710ec4d263da0e1d9b3ae8f09c462b9868e08097be87853408245ebcb6ca11fd2a3a088a50b5583f6938268ac37bb295edc096048eb5631b6a6b40dff8cb7fc21b76839aba5b869689fb6bf0cc19957962ac2d494eb03")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("000000000000000000000000d1f7b1b9069d4f8c7e623344ad8bfdaadaee96ab")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}

	dRootAt0 := []byte("dbab567d36c8404ff9f4152918f7d39b22f4383b4c4cb947072e1a2ddb8a2a30")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("4834b816824f392e22b4261e07552271a31f50a874e501a3847b44b4f96fc2dbbf8bfccf0683f05bac07ef7406e7b7ff281e8b415524aca56bf6d79864c34872be7da29679cf2ecc8020d96eaab1fa5f2733d72a8f1d81477dc25973446060839bb4ee47f64c3a84ae7be1ff35e84dc99000a129b5ad325a83bc080ff36bfdd3f2f8564478189182764b94dac8e17f0524931baaeeb91c9908fb7ded684d82ef3462307a581fb27a528ef9038aea3d3e71fb30d53fe1b0039bde4fc0d4ebfb4623d444669f18713db7ca11a439ad4b8b15d1dddffe61dbc9f55ba0692cbe8b0f2f3e9146c9281a76cf65bb5f48a2cf5b367409c22190debdecbca608384b62cabc7008769631e23b47d599e975171fada24242faf1db8f98ea1a86ba67509f4c1e2c13e73b1d021267709ed6bb2411cb91d5c6fc585f40fe3ee8ca440ac3bb4e19dc6a64419299eb41a4f5364d71968dc83381bf9161ec62b1907f0a80dda8786c2a35dc38f470be1a9b52c7229909139654883ae65d8276c05a70d308fe3bbf9e83db015528cde1435d3f418142ba02ecce76ca7b7d0f45fa77d35d8a4d5337a0f24e315512367b2b2ae4a8947c1f5f3f0f11caf8ecd22dfe28cbd01daf4e43b0525c79c05c227c1ec23cf3503f80a26abce175b71d724a1bb2b17652758b4ead3cf6ea67b11514f6de7a96ee233cc3408f8d1c0bfce17a96f1ce07b88b8a26e5c80784877d262d684019ce82fd01c01cddf4ab1f26793ba1d61da494324a52c0f13a71d7e725c7ca6f6d4de0b5cf376db59ed22afa8e17cbe07f0ddfe0b44fb3622b7114960527b8b1d4eb76b49c8229154fcf1670a2b2bd7eaec60e89819d936680b5e98adc115f53605ba2e1e8ed59358c908fdae540e21a1aa5285ea965a523f77f325fe2251a33294aa6de9b5e03708417b173db3aa978883a3988c8d5b945d42fd878471a7b207e97979403a532f6dd568d3f4ba30dff6fb11e40e34e3da0e59dc9580f9e43e1c64e4249cb1d3a2901c3f0dafd22749332ec85ed4bcf304736a4b875f33cf4dedfd364749a2eee96e0a37fcfb78e3d1c5e0708d80e766cc6d5743d6246a1911d290fe891353eeef10cadf8559587f75831b6fe74513240346baeb8d49cb1be53f56069e52e7a331d6f6431490430cafaaa518f974a8e15d172c6923b2db502cc249a0cfd6655bf6f5908ae26fd4d8f07f04984044627bb802ab5a677e3ab3e4d70043512ecdbc94c4d18e2c91f9dd35806df394f03a2292094c7f6b8436dfb1640fff389912b2f3cce5f67a6e06e006c103d36d47c8b5c56ee86ca65f6a22128652dc809c80b85162d724b0243d6c31698e38364a0f40ed9a55ff97875999dd6271250d64ed4dd1161e07249bc89440e0896a50881b9757548782f149197000be291c5aa04584b17a5082160fc09db031b7a1ec24df62da65046490f9098c95fa5f159a7fea3831e4ad04cc4e4c1684fd198266f88733953585859d8f270f4d186e94a1ea3d2ed1170cb24a891d8d6bd5a676101752071aab37a40b8d6ef2f1cb26a67340bbb5f9f12b5efe639de132bf42de4677b69234c8a25b486b53c6148066aa5e85f7503cb96da06163cfcd5715e09217a19dc7e5fc0ef67382e6c1676e7cee37d1e7b2c2c998fd2ead0b198f9ae4604969bf9e4534f26062e2943d96e121c07c44201ad1498320a355e31a98c72fda500d7011d8fc28a97d07f5696c215d17f45e1579eebedf900b0a518580c61693cd1b45854f20afcfcd3a9aa53e97cefb1e80d1fa2609c0fb759ed35bcb85b9c2e347168ecb16caa0be5311b8fe3981036681d2b91062958b4016f31246b748dbaeb1e20f469337692c28fde92f6a65c9b1e1b4ff9e1d1625ab5c2b6c8b35143a4d392985820d797927f8944b913b626d46b3c49aa140faf5fd688a54363e3474f8e9a41e777cd5383b236aa774a4e7063061dcd63a220ecabf5523c9982856f37e617384c3b4e0c93af685150eb6d7faa45b86a344cc8e7ef98633b0a543f86c13acdacacd34ad27c06c8ad296e432e8abc87e442262a19c45aa94bfe6b0e44518dd1008f9451a26381b39160e858d09c016dfe98796dfb400d0d7dfb9bacc64f3a1eb95cd0532fa846ed120438ba5e1d7e9a52514e41a593764c502881676b0c86cf97ce425374fde293e1a2d2ff714a17cbfcfa2838e0025671a00294342323c5e668714e27a4184f3f9246c680458e5686cda9a815c6fc7dcce8b1483912a6fad1908007339ce26e02ee7a50ee59c00ae0cbd08f0a8b40c24dafd2d39a8d06ef1c24792bc104b8dcb6df6c6c3d2e6cfe21276a86f8b50259569cc8c075af44215c5366aee11b25716f6c2192a9099c0c9859d4013f3d9458df7e8106dc03a5670979e9b03da889c12fdfe7c55040424e47ad0a9470ef3e2f579e9821ca0dc7bb1cc1a683bfc060d8fdde05c52b48c58a937fbbcded1141dd00acf32df4b00f40e4b7f81e5d3dfa111cd79019c3a4d6b004f9d154f3e61762bd7afe241d28b4ff208c8ca2336a782d199a1fca1965e0c88e16c2f31bca437d6b47d79fcb7bd203750d3427d0e590c7e41448ed111c762e401ca76844982a93627669d646425ad66b16e291dadbd744567b23b280a052ccfc549bfe59f178fc6a70684f549fa921f36cb70af1b0eb3189adfa5bd9da36d901f7417f95640a1f56e855e1e3bb73fb68994680b76d2482ea4a3c06f2bc6a9bbdc904f9784aeb6e90e60c64ce300a0ba0d5d8d74a6490dc537720ae5ad3f9beddcebc2e4950aac9f487bb67c46a8473b337723987b901fd446df8caf4195b8ecb65fa8a76eb0cb033dd3565ea9bf55d50890843862174bcd919136b75a00052a5a336634a05ff988de2e80344c6be045c0a34f563cdf802b58d50f4b924e101716b7de35b04718f6fbf44b3cfb482517991c40b549158c6914bbf86de12f297fb4df2d7ecc8c2b761e4e3f6c843a7e7aef7cd6980824a9c31e8e72ee6ab1b848bc2a58a097f6fe7805cc92c3c99316e1c454258208d42e4f77f15eb3c39894de723cc664dc1efe0e641bab2d047213362c0ce4695afb2c80df81a34ff9d5f65b714e0f627758a2e3bdc40f7e9f1230477c58ee68e6a343bfa3df5d903ba56bb854244db508205529a036b04f995f5ab8a467d3cf108331ed60871d48bc82fa33c07e365e79471aa52d064a483caecd5b08ede65245df102a93d7e9aad9d5b96b4f51a5218f55a4f0879acac75d8fcbe456886942a01c6c3db704edf436a568e922dfc52385cb35615fae84b1cd830053719958b99cb4b42fe04c2370efd187bdccd4aff9dc7d3672499a9f7b7c0f54c03491fc2aca1444042d7ea129ddc240bef3c055c75e6fddc317cd26ea028876635f170fc5c01d85ef1599a6002d68373aa6aaaba07a8e627fd1d47f05abbe1304c5738660ccefbb4572201f27648e46671ad7f99d750e04c81e33f9d87097bef6edde4638ddccef3de58314a3f81a296da15043eb1b24e583af24b7a245e7f97f388f32e3636482982c4cf2a3c964a242be1b383d795ccdf7b9a7b8e6b875ebaaefbf241a3cd7957fc4bbed1bb170662ac222335240e5b58f956a18b177828fbd6d579f65b788b41e54754f96adb45c8545c434fb109d3036a0763d77a28f8155258333abba0a5057268f8c72fdbfdf313418b0a98745e1d0407c00967a43b02e459fe643d98bc6412acff379f4dc952ed109261afad13ce08906879475546a2bc28d7df19853df475bfedd68ccfea4de243765fefbe4c5535726000d59107f2b8472bcc39dc5ac3c35bd451189f1a5e0e89c7c23bd5828f5467b2f2e3cfb2fe3769108522f938bc2b960c60d2830b94154b3040d4778fbbfe6e3b4f7ba27b7ad397ee6b24cb55cf66d1ccb8ff869e06f56824cc8d64fed700a6ca2d14bbe957e00c188c76ccaa94b4f1a744c8e10867067a52245ff323bced2032c52869469036e315a650ebfa6c9facbbb8d34a6402cce0c3fa4a7b56c27712445dc8da0f5ac43c5a55f8df0aaceac7d149bcb9461ae632dfa6039852cd71bd3576275da0d2b9fb6be9e91dadf1ca85f5e7d14655977f0e6ec144bf88dbda5c6e870e9e8200c722e8e79e4f64d5facf8a1f38a4a0a8a9be60a6178cb00fece8ab352a59e56aef89f722354db21407e4ba45a3b6e972a26ff57ab370fc7c644e34cd03fc61084763b203dd3688ecb077670431d8706fac6dba098a4e9ff47084ed0aa56e4cf67e280c0722e03ca54ee22a5f89c94faa2bc27ac11fb4afe3a56b37c8bdb059f33ff3d4c725dab91b992f728fed7643796f5fc0b1fc54ca978be9f6ed4cdcc71cf366c7c76321fa52da8335de327b1102826a1c8017aa2579fb56cb4ea8227b38280b0886271cc81b4da694e358ba2c748b96e6d81d345b274758d40aabdd556cb33de44e5a4c6cbbcb549c8bece41bc716e10191c807cf180a6d17ffd800109f619f34d4283bbda391cdb4c363b3c4cd450ed13666e4b157a1804ed5d5e61234a1003c06179ff2e0603660df794b95e90ed666154f5168e21f5fd769965bd630796eca7cc44f2df8f66745809c6a11438d4d942160acaa9ba5eee229c2164cd78c09741af5b19de516ddbd78d73d0a78b7cc35346584670b16697e135235a88b2a664504e53812dc3f2f060578403c73cf7cf832971c9140cbbc654eea3827d6739d74250501812ac86bbd5dd8c9e3ed6aedfd142e5249be77aa29ddcdb4073179179bb81838ec287b55d23988ee5a4e4e92d7bf84e68c8a832ab042d2d58d96723d1cb5d6ae84a10af9642216ff258bc64acc47f0a3d9b6c1923e38230d91671ddbf36b6d7d3efe6da26010930d5dde9a321fe162a54cd002ba78d74d445979a2fb29447c48247d87f331d4206414d3dc78ed06a59b524d995ec5c397d62d2598f7f4c50972c1d06508c8172eb39c8477cc58ad80d159a86d535276be6db337eaffb5d5e5c95208892fce5aa3ea38c2c30c579620b76795c2fe9ab6a01828fbfcc5d258964a9289ee2e22beffc3b43f2c7915054608a234bdad2eda3ce03f2da06b7637a4f6ed3a85cfc3de029b0378384906249b4669ba9af2f4f111e056456710fd3c517397450b83465501e271443659fbf92290254beb1c4de785849bdccea544f5647c21224a9be272696e790c94a77d1474a35d7dfe37cff08d6314edd5be89130fe8228d47e399bbf122c26fa499a8c1a8bac5961c629d43ddce54290faa925170a7115e85754fc5a02537f48a849df4a6dc95f6ca105c8ed83e3bb9de88f1eb931d70a09996aaf579d8123c0df818f748cbe2acec5f58c02fb4fe8070f55fce923721d3989e08f90a0e7026b9d8a5b4b3c25f07b2719929bc2d92934782cafb5a41e07e740719c21b1f910f814234728bd67b78aa2619b81b33f2c4d71bf7a03f02e2ff422f89e1836f095b27c5788359f743c79adea953b4b0d92402797c4370a0d3baa63ad6990c8d24b05948dfdafde547c66298bb4cfcd5fec77cb8a8bb604a85631c30d396833ea25382ce6b3732d0319e2465d2a2a4e533ee223a54cbf9c8633055ca100599bdb89ad08bc2b5d1a1710e3f683c92d214ffed2d658e5cf46dee73d266a95d53eaac7b169ca219c60009c90a5a4ac02987d106d48d7933508cdac7e031a9062453e451a7c5fb892bd3d90298133bf1e7975e3daea355bc5805efe1521b6dbc58e426d5884c831c98543a6ffe4856ef7313852d664d8e31ebdc8153daa0973cc3f5c7624cbe3d6654e9bffc5251ed08b50860f9f11800ca9bf5c55a99e26ec6ff490e827fb8b8f4f295027d44f29d9d79c4ac94fc6ffa01e226cfadedc54fae9cdcac8ab62c70e0f7d5850622e8a4e75318621ccc41e7994bb8ab77df68157445640b3ceef7064560d5330091baeb003917e5b707ddc449ae3be5eccbd61aefa6509db1095b70e044c8c31136e8ddc8056b2ef5b5152126c59923cfd13e16054ac9632be1fba8fb10749b44f01d7d7942f7584aaab82c6f0598ac9f14d2f250d7312ef364559354cf7da063f6c6f1900af22daac0f5108d6c186518480017ec6a63fd006f31a2733afdcba04d0e1d42bd23f7846a5748c3f8ae190159226fedf5b7d9fb7b4ba9bbc100f75a9bb613371a5e4761eeb49dca8ade278e41e8b5237b03392097ba15b378944af2bf409b6ee7b71c562f42adf35842efd955c2de5654a378f91de7e60d9891c74a91c3a61dc3a7ec0e7904e8e2c356ad868cf6e19ccef802471c01ffa1d421abfe9b0acd1fa2f16d12b553a91c0e872e12aa640f1a7a6d6a612e0bb546af6af8103bff3af5e7b0bb2a2b00d7a902821bcdc589a6a4a9f997eb9bec9a82f15e57a29f156c39674d6c72e0ad24f5d3ab8ef63b98c889dea3ee7da770a49e9c33f9a819c42a0b4902a1a591ab1041566b777b86b6c51a4f62656fb2b5b70b7590e1475a6a96b5c7cef4191a357f9ca9d8e81c3f5d757eccf00b0c153033d1dcf56787e3ec000000000000000000000000000000000000000911151d252c3438")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	deposits, privKeys, err = DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, depositDataRoots, err = DeterministicDepositTrie(len(deposits))
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	if len(privKeys) != entries {
		t.Fatalf("incorrect number of private keys returned, wanted %d but received %d", entries, len(privKeys))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}
	expectedPublicKeyAt1023 := []byte("d7d9cc6f6f93a535bdb3b18c2daafe7449b4f8766da05044a1af735983aed8d7023d15a7d9b279e62ce2d4f1ef021f986fded4a718fd6043e0a5f60253f3e196913b5090329d2867b49473ff3c52dd22c55f481e763a27ad4b1431dc116a871ef36119295c6171a38583817a5ee246a29f730d76b68be9b6a3cded4fb1104c4ca5d4620d63e4dada42be5e027bf1d73af19ca6bed0df3057bb9ed15f072ff61e391bc43d89692450b3ffba273dbe7aac1b6fb85405344fa9763dddb02d0a46d559e2df47032bc90b797531e56364b4ce6d6712dd6bd92854614053a98342efed93178b05132370924f17049034c079074330326c5f4378a052aa3e96200eb55582e923821d32fa8ac67fc59c0b51f30d9748907e661b0f066085cabecbf4ed09699b3c7879306f82dc23bc8fa6d065e5c9efb6bfc812259ef6750fb3bcf1888c4b1e44fd5ad4e3fa62cc0ded3d1415b71e2b5bf79a5f4cd2d4ae2981112b0499de2e9bcb3591a973dd79a5b1ff5727cc0e1e57d7cd93775f4424231949c50106f9cb49a2200ef71378dbb5932d4be211738f8138c49f1ff0f716e3ee9c7c54ae9248cdd7c6522072553b3af391a331492ee3471afe566a58f84d906eab10a5ec5d28b2c2ca5d7f26a861b41d15976417d11340559bd1e56d527a02bd0eca42a8d8417878ddb63cd06b554f897518d2b7bafd51dde9d724f76cb338d59b3e077dc2092efd4494ef566f9530fde5b04ddc497acea8efacbee290c2228c270f8bd27cc2e4c17b59ae731d268ec67593723867f9032c7a0bc184dbad9b7ca2e5db80d2bf1898401d6fcc63904f50e50041d9a23ef760137106f6e150f8a12cc860d8a141d5c74bb21c2e0ce5770b4fb8f2fc85bb5521114b3fd24720775e1c880f96a4c9a941b6d136b4bb2d48af64104191641a67360c67fc9b666922043625c0f508ca5458bc63f847da906a89ebd4766a6fea12a985407dd61b94ea586e3ff924a2969546ebd0a052ad61d8db0a2532fda08e6b922371b1c56ce2eedf95d14fbbe68a5b3ae2c24d03352143a27ac53cc4d8fd7bb4eb4e2fb7094f2cdc996dc9c95fe38d1fec36490a6370ec7b5d7e2b5dfae30ebf0e91b6a0f328b811102dbeadf3ea43a09747d943974b4d7b980e262fccff275d6b46edf124269b6abe4d300a7cd50ac1f1a7a1bfd6a10434d56649d67b3cefea9ac826c11da4297e935074432bab3794bc6d7076d5a7c37014b6bac95daa59750babc1b1691e04dc78fb02e402dd3d2f54a1808886358aa9d8c1044a05d94d6fcd5d7693a478c77ef33ac98539e2fd78f98822d7220dd3e2356866d5493bc0fbad97e4edb94bf48f57951b15509c7947e95bd50ebbf9633f3707e6a1e41189a5175a5f23319c9112909ee78ef9ee12c06a6bd7cd2fd014fec6c701829db916367c2534866bf2b06999e377c75de39b528de0c99e374fd41868da53d2f8a2d49905bbcf74c8f099781894df4c7830679e0eae560c38d67679c206bd50aea6565c23b6793e7c7ba1732b055560f8238371ef3aabf503602fb29255b1c03b292859b6c6221faf2d26eeb28781e9904c64da76c9a0f31c7641eb10224bc8bfad7aa4929011c9021ce9d2220fa5213ebf4525cc6d3e6701d89375b5937355a76c6808284614322c76442aad7706a7563d79b32c3f63d274bf78a090b648665517ee53957415334d92e0213f27ce56fed5931e842d547fd31f030c54c1cfd7ea29d034fb74a9c347168406d86c4811ae8310618e3d3a943d0572b0e3a0aa5e7e83d28803086075c539aee838715a6c04d1ece3c711d981445aa64b389edc01a76ca2519bd9dd3e3bfc6596550ff49425a9938f6767788207afde2ff979448dae2f8b6a4ab1c2cc216a187a35c14766841917cd9fc032322b2c5cf2ee0e77bc76368f2c3c21a0b09557e1d3f2e67862f4a820314aecd05886589a48680b5af2e62fb4cbc963e8e111ac3f0443bb4cc27124dd8f9cb2bfff27ce5446d8dbf83e592b5cb90f452fd8feab733d54c0f2bbb91d97b0bb82e7506661b90be6aaba3ed8e2b4fe046877903b5eb3c685c7a9a6c987b631e0290362525829df54fdf01a20b99483ce0e0175907bf16b1b0f0436fac3890a383e1c4bc70c7aaea2cb2b1605c8edd49c9bda5cf38592eafeda5a5a8a623dd74cb1e05a9d305ebecf41f81127de98ddef0bcff6af27f053eb07fca593d513679cecd62daf19701075137208ac8da1fa001e87a40777b787a30fb2d8c7e097c1aeb593bd70fee895aa8769a6430695b929acf2f079d05e42d5c183d49f346f120d63429920352d8a844d34e7d045419389995e530eaffbbef107fe2f334cf7a2ef055d603ee30bb651ce635e00b7f6502b3cccb7caa5d139b2a21d740d5f22b68375b11f21785efcef340d30dea2b81a1520dd1b453b6e48eb84a6df60ecd2848acabb33f15efa01b2f340e18dfa4c685fe9593ba6accc56b373dc1ffe3462e135dfe2e05c8f0e9b0a9274607de493a5c796528f76ec6c7d19a064a6fbd0e851a35720aa7b7f298f89d0723a3172517a537235c3209a09bb496cf6985dca357c4956cb777f8a41a4a271313b081076c40d47be452b9ce3ab968568b2f6f2bb7cbbeee4c448b0733c4f147e2ef4bce0054e84b3664d810b966f9e47d365cbc45cd6ed76732cdd9c735b2c9fb2e4c83a6bcd234eef54178bb50119f9df15ce0ef12b47db9da98c97430d3437a23c847929619a4f2e9d450dec4672328206abf5cd0a6fd2086610babd2e133e845b819b11c896f89fa0ad55913259ee778e3461abe010bc0215c06c09f330a4de022efa3ce6fa40f46fb3b4da4bd6bc08a76386f3cf1c1c79ba282326eb08fc62943358dd215ee3245b4d96ecdfb883a49e30052854de7c5f68c56faa1aad3ecbc6d891662d181930f74152dd66d691a4e5df829f952ab3c9ed99f4e045bbbbc73cc78f7f516dd7343f8a4755901ec20315764dc52de88f91143827f85b72ff2dd9ab3a19eba81381b53c6881e201ae324acf0d14fc6877da88c7c1ff9d931a459d6af0af43edf4e693e0462d5e66c08e9100deeaf88143d7a987ec3be1b2f17e3c4d2f2a6e4dd98e24859ba46b363cef8aac8629d5decc2f162971b9ef9dc4a4511b0fcd26ff8b383eea630d1ca75830d9973301015de99b82a372b747354dc975e010c9eb69bc8939fbf43ad59ed5065ea85582102aecca7b9c2b3011e71b3618902133858c69e3393067d1d4d8aee62ddb39c5d84107528b21853c72fe7cc48c189dbeddb4d355328209800a39f94f97fa2e6ac607e85450c2ba3aad8665f18e9e3f24855d0d6f8577d7b46b291316913299a2c219c8ef9eb05f1b3622d73fae3232cb8b7f795e76b8201632e1aa50c2da06474228e3654a07d4ae39ed12293271589ded65f668f94a44d52cf8716cf2e6988d1ed6ddec46457d38234ae5b3a863658d7305aee0818f10cc39e1f1c6ffe5c669f2e875bbace3f96f07d8ad6036512d2f308c8511952233ff7d7c8a32d611e800d1f78064635af0e0de0b11e24a6e5b8a442857b6f3199ec80d266d2d50814780d621acbd3143cd26b2ab26c23ce1015cc5c2bffc0b8d72b180834cffcecb5e2a2f9892a5dd5596572f72f9d9fb962fe8a324948f4ec21bc5234afcfe")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("0000000000000000000000005c1a15eee3965473e8b2207bf0060a81674d126d")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("732f3cc254709e8b26d17ba7cddd4f24be4414cc688ea18257c1511dc9966cb8")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("127957fd7cfee7b80f70a3117f57a62be09c0be17f16fc8d060e406450fdaa58aeef84caa7ae7a395be8a493fbe5521cc1c3355a542f70e358029a297a2b50f912a60e846b2c923af3bf2623659532d4e06c292b66c6bd294184cea2dca3793c625e208d3bf99a2ccb83cadd65659c46de60eeecba7c5806dd3f6077391e50dd11a4cc702cfc8183a1b87f57f5a485386d0204ee788a41298e32ca694a10d5ee54561f6bc51350bec5616130f752af3411099c679e143bb465800614a685d9a11f0f66c85ef8c6b5f695fccd74bde66c2ee5e2aa17bed4dc7c0ef048993a655450a706ebaa816dd9b918376d07dc1534fedad3f5be79e374c32310d8c7fe4e84fecbafa67e6c670d24989bdeaea445b0d57fc959566f10e293997be62abaff0dc95deab3573fde3434e496f64a07ac4907084f7bb95c9eab14238d56e1de95a2ca1ab22f547d59780ae0ddce0209bc6ab631317bb239aa3a0a87a66f7601373178f916a6d858ab29598f61d73dae603cff7bdc30547f626f2d3cd5320dc65703da2df0052480dec13249b183a0a8e94b48491587aaa9fbc6c2e9b6ffc1c5820b2a1d59f07947ec411f5179e8b0b0f3f032b3eedc42c59017d885c69b269fca8776a2a7c40dbb9780454f8be2d55a2a99d2c6e0452ebb579dc17d6031d0cb35c6c8e85e41a6975d7581c69fe7f8c640fc30ce9cdda2005afd202217748c3d184ecbc13be29319eee1c10fe28b05ad025511b2b0cdf1db0aaba54420958f79e62703432b450a4d4d494f6f07689ca2740c376501318e5581f6d1b4cf074ccfa92689c55b986dc893b133c240373a4afae6806a1aa0690a50742ea91a91a9e7d21e80eb05eb0b335a55c51cdfe10affbd9dee05c5a32a35f777db5e1f91d15c23ec8573531c34412ca3459a1ea5e7ba013b00b753942a6e10667615c29b39e35bb0fdefd71df8ccf1e7cd03be1eb7b9862190e35551a2ebadcbcc8b5a5aa17738b9e7b888a3ff462d0c9a4adcf4f5be311d0ac7692fad7c5b23e0ffc6c63bc30c1ddb5e99d92c584ac0da8aef4a279c3e173ddfd5c77a691bd9e3ead793f378eefba73d34165d0ef62cc9508acdd7c6f26273695b2e56e0a2253d7a6d2926df3d2df4fc7c5ed9ef6b99bfb4015c729d0d15f46a43dc009bc93c61d0900f8241034c1923e6f83c611d78ebb86f1b73ed4c43689b5c3708b1b471d440bf219b97b7499d5b4e15ac7196555bd8f21fd61613077602787dfd6eebf08aab467bce492736a424335613dc28466b37ba877485629080741b1798697ebb954cd2efac90c2d07ace620326e07920b57488134790791935054e3cd2a7d31630237e89bfab53cc90e3c92a7f734da7654869d469cd737492dbf139e73cd4a3dfaa0111b506d5f08604cd54487c3fde3b8e10d6cc43af4cd6098908e34a8c8f997e3bb7ba48bd395acc3cd11c6ae9417f0ec02ab03c1ee8c9b247423c354f8b9ec693ca4a872f407b8ef590d8130a007b0271dd63e2cc9727dd2250142ce762770f074481327b6e48cf56435e1fe19629d575a7ee5515bc7182f372cc9cd687783bb7616f7fb34ffdd6f880170afa6cfa0af8b4e0b05b22b806cfa98a91e90ed3c3be60ff6a26c8124075d53a6ff8f2be595ce924f5badeea6c5270cfce94a63cf5b53322c8a27f600fe4533ddcc24e3d92e0d0b535fb8cbe050e6d2b2318182e53f4edc95b0ea1d0f45a2dbc8b33057914582a8f7ed48b71f7d63ddb161c294a473b3fbc704bf1f4c1b2890d7d7cb5764850ee9a760fb4b92b246c65c67437a4b3426f1c55f15f169caa9cdb09526d648530883a070c581cf180aa6ca44b54d7b918b79f9805cd71fc26c79e25372ef4787a72f5d78a8944b6206c206780e801f0e255af2ea4076bf24b576bbd81b89b3f6f3156a31d268f5b46c568b7062d726c4143f02dff768a34b820d01cad773d8b98e0750e9e6844666bea7240a736194252a043b0280cb60aacf57a015b0d84ed8812e0bbedbc76a5d34619c35a1b908f0c3cdcd9b09d31deb84d59a5c3d7ab1409e1d396f26699ed343330e6ea5cdfeb79963ee83429a4598a9d4f96f9c8d0c09e1d18d62b3a79dab761d39e10c2c6fc90d08a736ca22c9d4c5fdb9691ea2029bf56d33daeab7363062c747be7831a6f027761d1ce1d3ae6912fb0b0a7125ffcfebf8cd99ea0bf91d565b8bcd17f040a312df7a2206b282bf5525ea8de452d63708eaf4bb2b9d358c4e1fd9e951c0776e812dad533225e536bd70e31dd51e22222d4180365d8a32a3ab491a69acda4143134bbbaa6742fb2043e52ac163db0f44a585523f1dc8e5e2518013f580df9765cd8a0f510fba81e45a939ff98766b40c0bceaa147af85e46ad5d9c03a45cc9ad8b0aab3e48734f8e7afce26c3b1839bb8c099ecbcd82a2f77877fbc75d6f209baf9b073cbb45ef3a5b960c015d165e7548d908b9f038434f064d142ff45450ecf0493bb285a12abdcd84d50b2a5e77a5809a686af4ee853f6adb709944420b9400ba11c76593d24ce7b7bc97eb8c5c80051f5990c6ad75a377d58c06f3503778e0a9b4733a4307844b08f2768c8680e595943d4ce20d23ea82cded4c3b6a228264bf9fd1acfbaa308263263b64753ed3c16383df52534c8526d4423e22c16aae5de9a5fbe6932bcc8ae4c9c8e1be547c1ed2cf5bb5b5903fb78d5d837b7eddccf5eb42350d6d212c9aa6f1e46f637ebb3ad5ee9d5e1fc60832b868ef1e7e611038d73cb1d6ba1f7b19a23e6e3585edf7a4d16fb7fe439a8055f48dc3696da8b4d7b5d241aba761f63349f7146a67c5174e9c0e425e501a986191dc89ae46ee69e1cf25ce047d298cbc3aebf4852f338f6240065d05c6520ccfb31ab460ae88ce2274bf8e7b3f0f0612c3ac2356da3e25a2f8f219057ecaaf88e3e1ca125ea9edea5d5756e36d81e41fa9de873cf40752be2d329493c020b8eea5e3d91db268e9893f7957b02718d76875673cbf0be4c37205c90cdb7c2ca9b109db894e8946ff7ffbd36b5cc99e4fc0975fc4b6972760096d3366da48e0c9984b266d07c035e7e0d9d4202ff8f364555030d182819346dfb3d34577fe22be013c902e902e982665c5241ffee99d4a10a26756939250818cc08d076c64a739112dfeb55b0d66a64be5e210b9089ed1622d078631b4492a6abea5d725937774b6634893476cfda90b06a83cdde7a47558e08149f0cb3642fd6084dc2426cfccf22effd8a421d178e6621e0ed478753a747ea0f4dda89f1a71cae6cf4af0e54eb3b045ddf5d2b63bd8011306a2303466b0d8020e9f37ccf9af8e04760e953163f6c16808e0d2bbeb8de575fd1110c93147e6945adabc1bc78dd6e5e1c9fa053656b420af3bc581f71b1ce8b1ef22364f577c6e825e2a8a2e8cdc29b86bb1e5687393d0733b7c8f8ff16304498558473193ff015389ed3e69492276b513ba7cc9257af914a204e3862917308ee2ed6311e986712345d24503c65879b6affd4bc56c60db6f69cbacac996d6122c4ef1673ec44a260b852d00c5588111bccde215d2dd4a27a02b65f8ffd004bc0a114b2bd5474e772d89881245eb6df882a6b584077943659cdaf7ec39b10b3ecf99b949b453bb3ca41c980f61e15755aea6f8844c390e534b48aade1c5aa953e45142ed323d21411de4f133beff2044333e0e6b019cbeca4c9f278cba2e4d83fe4b27878ba488101a15fc317a77e63140e8082d1b84d754b4b6c4913f1f187a7728c926ce695632ac68b31d913dbff43a13f489badf4fff4f85afdfa607068a53ea1036202b7f513bfdba5e1316b1f056f33088954c6280c11785c2c5889dfb661ea5933a7cdd5802bab647706e1196a0e0c3a9728cf382d6e5e4396a4cd7fcf3630b058b81dd36d908e2fdf02b885e76bc16b27adc06a4fa5ec51914928b1fe1171a18372c9c97108bfb0b262e1aa6acac0b7261c6ba349927e76ddd1e29a7f418b20ca70d3cd9ba0c6241bdcdc0c28992f97fe9d70e20120507aef1dc7ab0dc7c58221e8f7f5f2032a8a2909ea20002a953c2c3c5e6d42249126af5cf70d7f46c176ce9deb7b5983816fdfe8b4a9833dbfa3cdb9c8f40aacb3cd038d12bfb28ba7df5e12e20dcaeb4af37c9943e006afbd9b01cdfe5d57f1f7db07c2ee782983db7923b0876163cb986af4a16bcf068c8577743fe2d1c8a4c8cad39c52221e44398e80898c3f0067c75b79464f8e3250f8a13523345970afbc6f92bf5b02777da417c3cacf2c635b87027c598fc349333d7c4b104c24757061e8b63030bbaf6075fc952201d63b4a43f4be54c6cd4a71a7bdee28b4ca080d97d5704784e0e2f7bea876298866f069324efff9ba89ba8895aebaae6c03de9fe118cb113369e3fef7823b3dfb17df2e23f3ffe89f82ed8273425125e923d922624f06311e7533867add6dcd4187957d68c35c35f5a488dcb9f76b475a90fb325495e98c25610610c01d5d740dea6ef4dc726f44b73888913fdfa0eed6492134dcd6ba1bf0a91898ce4c1e8589f0258a1427c4d03e8efdc812c9e56919cd60a0978c57db50f40bb0fd5aa98f496e4a82041d2f65138e9a867c9faf1f3b3c0ae5077c8e53d6c6711feecbdf9a3cfb41357394d9ebb7b397024bda1f2b4a8777d9bd52696b50e6bf19e20fb32c3f9c8f1a687c4c24676bc71a2f46c5e231b4d745eab2c35eeb8d5b0bf1d144fc50fef678f82605cf23fbd6644190da39d879ab6942b8f11162fa15cd5773e0f9edf228694678795779a4285cea4f2fbf07370cfad2b8a5a9f26f7d6d2205c7595e9e19c9b3e117303d6974f376a019a4016cf24efb9ab06a7d0350c8508e77fbdbba72ce1a8eb7000489f39c4f3f1e2a65cc5e2a65a9b379cdcf91b169e6f7203ba5d0e3e1941b0a6e3ebdc24b123f51a981065c32c76172febb44ba4500dc3730bf992d9fd0a284946641f281b342ae53895442ee66b32ccde60f2bd91cf745a6a300333ab7dd6fc522dcc9ad57b4cd2910dab3354866b124ce48397a45ae273482338dd31dce2f33b05839e39f90c6391c7ddd1dc3c5de98c3cc4c194299f997e603cfe40d6d1167972326075cc09aa06cf2797e1b7be01953eeafdb79d06ecfd1bc017dc41a9a58581de34141ef1e34af34b4cafa3d729776aff479f4e2bb241e765853ddd70d43f7d13801f69e80950eda0e75621591ce70dc29a16caa1395ef782aad00a38a7506376bb0e32069a61cba71ef0c0dbd5694ef268522a0f5951ef8c8c01e3ac4158d76011eceb731b5a837a9005c1ff794ec5a83b3c659a662e79bca13315d0a451f1f9441352d98183061afebcb37309111189641e208fff2b57d6b70e6736fc1ace8be75752d7cb0ef42a400ddfa06997d806e05f80ef83051d3422bf815199657e8a6b4b52ca73ee56156d9b29dad73e987c21e3c59045ad7c5b90903305ea3bb87a93fedfacc06e12de2acedc7e5e132f8d0dda6c218ebe4bf57a491a069c80fd9de4f4d1970aa6082d755551ed419d91fcbc6d1b20f9e35bba3e27d4b2f1211a8815ec1018d059ece4a8c4002c452a83046664eb14411c11be217051ca33b3b3f18786e2c40a743d697afda036c4550532fb099f9bd199ef83a69daf81552143318a2bd03c081ae40c8bc16a2b086d73002de19228d8e1cd6d2876134561ce15aed03f419217014747c953950cd1ad864745a60ce947e7701eb47cba3359fb397d7e5a46434f8d7ff613ee388bd0bf9ab528dd56f1a951959b0ecb2b5971c59f4824cbcc92f6b011966484150702ad95977fb947448ec35429885835d12ee4e95eaec2d5c28acc5306279a5d24ba370952e4e107a03f5e8e4fe26caba0f47dfb99fe85d440e6a8a5dc263fdcbedcf6ee4a4fe19fabd2505a9120d1681cebf3b6adbbdd12d4efb2b336190155d2328c99f447b977ebd4041f7073e956ef0a4262643053993caa6cf05cb8269dfe057d878f085811c74cff17a1c2a9e330987f55215bed22b869950005ad2751bd7ccadd61564063d72c82116340fcd59c2a2e3d268233f4e699154d8c04139b4c8b79083e79b606d40f47caa2173619e4b689f857e1e609c1650055c94a884392cdd154178b1040b38d10c0979c22d016858625b79d5e95d4fac9ee4396271f252e74db4e8a0d0274a8e487d402a007e2eb283e175c8de339f0116180d90fd1829785866c3eeeaf12072bebacf15ca14b67a115dce081898ba11dda915f0d915871c86ab389e1b820d5241d6f16e4e589e2e2aa9078802e479be55fd715e56b10ef31b7a027a70c66367bfde44edc3ff2e084ad06be11eaf919ea7ff9e057a9065342489985338577747d643b015fccd40f74bf00d2d25a0753ef48a886cc6e749bb1deaf7f9d37ad572d92dbbafc4b4a832d1bc3f9a44d72892bfa01a382b18b9c289fc80b01106c070f3a3f4f6e80cae90d96be2159b6ca18727c9db6caebf6f9202c5d989a9dd7ed11304f8cf1154b4e5f637884b8e7f4f80000000000000000000000000000000000000000000000030c0f131c242934")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDepositsWithBalance_MatchesDeterministic(t *testing.T) {
	entries := 64
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestDepositsWithBalance_MatchesDeterministic_Cached(t *testing.T) {
	entries := 32
	resetCache()
	// Cache half of the deposit cache.
	_, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, _, err = DeterministicDepositTrie(entries)
	require.NoError(t, err)

	// Generate balanced deposits with half cache.
	entries = 64
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	// Get 64 standard deposits.
	determDeposits, _, err := DeterministicDepositsAndKeys(uint64(entries))
	require.NoError(t, err)
	_, determDepositDataRoots, err := DeterministicDepositTrie(entries)
	require.NoError(t, err)

	for i := 0; i < entries; i++ {
		if !proto.Equal(deposits[i], determDeposits[i]) {
			t.Errorf("Expected deposit %d to match", i)
		}
		if !bytes.Equal(depositDataRoots[i][:], determDepositDataRoots[i][:]) {
			t.Errorf("Expected deposit root %d to match", i)
		}
	}
}

func TestSetupInitialDeposits_1024Entries_PartialDeposits(t *testing.T) {
	entries := 1
	resetCache()
	balances := make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err := DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err := DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)

	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	expectedPublicKeyAt0 := []byte("2e3bcd95f5e30d0b7c5577b66c6373c567a6151ea39a75e477fb9b979276efac8952fcab3b1e671c1903063c08de679ae4fdda1e3f2cf675364a0f9fa5cebb7a6d69dfd6fd5b060dce52f19c3d95337ed388b53ea8d9340860cdfe449187d617e072979f84d7c9bc1a7169706b6fbe01e51c6c8117be3d61e79c046827d095a6f88d4c452da251910d34c7e77e773d667db344535b71998d33920d21d03f16c8b60d27448d24dbe239771bb312be22ef881e919a8bb2cf63108d6122f1ccdd3dce3ccc39a4bf06bfc8acdfeac9261cb061b64e1210dbd70d1da94145fb46e114fd61111c7e28f96a8023b4b3d2b705e347d9d5f629e0c64a533eaf0a84095ccb609196b768d1212db3d957fbf5df67fc8a14c72fba9659ae677647c24dd9d121094ac1cac39f14fbbe5e8624808f004e970b3530c5118cfbb1f041308eba8c8a5bec6ac20805790eb793c21eed3908c0ee74075ebe0f8367d46341f548326a9dfe96dc237a7e103010c5810472d071dc86a3f12936e8f3181eb8de498719acafe20cd59f8291b0313fa70f9843fa65a49712e92516accbb9d2c30c341b5341d618db57299937b7bbd7d51ee9b5e1329cfd725988ad4d8f01389497bfcfe904bbebfd69e9adaf1afa15136f2fe355d4e54aa4c21a4c41bf1a9172535504058d7aaceb9776f16e5c209204b755de6a978cc9952d4bf45b24718cab949e198fef31bc14a09f8474ee0037b758bfb952f5bf0a5f2231c02dcded4c85600a447b80ffd39d6a07c9dedd7efdd45b9c855d9a9b6a88f1f14f405a7608c1f64cd815df316a3ad8442b75df79aade1a9156eb917ad18251406a277cf38f9870a7902b4422931d73406f87e0802e96965773935d2639a649863198d83946425c40a84413d2b1bca109573dc6298584b8c589373be2ca7732478b220b1a214182f96a26c5a1b45dda66d2385346301d167d30202b4fa6167cfb87ecf0377d33a7cac6f38b29ff384481c4531e47a94197334e8ff9f77eb868813f9d5ba5249d9006a2317397cafdd206375d9654eceff93115a530e84ae55a7a25d02d44d737f42da58486c7dc3e92f3312ca80dfe2a9e87a52c6cfd852fb23767a9e551455ce7f2629855cc28c56e83cd6f2e1d4e3f05058b6a748fcdce270decc01149d96a9ab1f4f8ac1c72742f4fb0f602144e018697134d9ed2a5771bba1a8702ce94fc1732299080616348bb6eeaf7ed985e881f0a2a407b22e3a8426d4a4e2ceb257d4e635cb12c1706edc0fc77043652f3ccf3afa7d2b97c3b60bd0078d7220de39fd1e822e37c6827b870d1ce431015b03b1c8e2e88283bd8d7c6ca88673f7141d88c702d4f2bb35aa8f953249f429d7f80a67ed4352d5b2b79694f545f89d23e7e4a96c98647236c55bfe2d02f1fcfa254f9089baef4a5c8b9ecf5936cd6102500d67993ed92143dfca9c60caf49b25096c79bb9661839032507f99e8770702fa74babffe16da6b4c66fdf47e9fa03321ec973582dc4492c3025254037f55bfd47bed448105445ff7d9f0b2fbb84d798151c6d1255982dceda6abe534c1a487b9f0a2669faddce68840651c57daa54664e2dc11084867d98687a17758ddacbf0b2088e46f1c87deda65a904020c187e26fb22053aaa4daea57caaf9df6119909e727447d483492c961f72918e4dd8a7e543aa490b39c1f45e05b22f3e9023bbcadf0f91b3fdab1ac16aae2d6f13729219d5ae70b2ba8b552f23a25e56bad561d06c3c33a6578a966b9a9e8971c6008ad5791cd87ab2da27690b3f2868191a65abb6add5f72613a6ba333b1cbdea995cad79007eacc931061cb6c107b55973a87d15bc9c95d2d9e4dec237ddf91672251a05853dc97fe3ed27196814cb6e84f1e28954693475d382b6ec7ddb594613325d2c82a7dd9bb6a429ee0037cd8af2f129d871eef4da33966edecd011f0d271e527fb694430833bd7acc3b2944599ba3e13aae3a1213bf265dccd53123b8b285d9158d072699fc8c68d461550abe4794ff7397d1fc1adde7502be6e93399cc5ca0963d38be6923b033c6873b9ce8d05c0de899fb116ffd20822d8d956d1dcdc823f5b3682cb12491d462c1d98600f2b48ad02ba7090e2833c8b8f374229074d21f13b3d9c0923f78624e8fe2caa8ec57d7b321494d796f742e93c9e049cb416b05a17eeba52799113cb42274ea07fa7fb8405f5ea726eebcf15da0173c344f7f85da412589dd30c9a9b858e1cb3d36fdf3bbe988ff83ecbcaae06a40a7cde8225b5e02edd615a0c89126bead1380a4c8843ad313cb94b040dbda8a354dd11e2725584d500fb61adb7f785f253e153998838e5b87374f1c759e48da79f1d3e44c3c0c0ac3b13473abad9cfdf60f5b572387c7bebaa4a419d8a0cd26e73ec58ea92f80de3f9aca31f1faedf94d82b2b35f2520d4f6167c6e886f84620d79d7d8859f8562bff408f7fb3bea11c3ffdd8074748e10b22ed1bb5955daf6122c8daeafa5541364845f149c67ff83a0f8517fc6727b4c997d637c3c46bf80c76e9e8858ea041cbfee49fc135fe8ef082fab0dcb9c795f81add8e0d7386bb2cee496948b9c8bd22d3230d400b0beb119297097a73e41760df8ae3f22ab40d0402238833c5e12d90fecb1ce9c88c68f281baaef15cdadcdad4670ab0dec84b14adb9c0325fc63a05bc66fbff3bdf45a114f42c232ff53d8bfb3a474ce5c4f71841ee198336d4eeec82d52df5c4098f25bcc88f894a091cfc63203d3d50b5d456143467018da3795ee9d84508027a503550a813be30a3151bc1ca3768307d381e9184df8a3d00b20cedde0d82a728e2e714d1461deefa6acc067397ce836500289b57ac535aa19317dcf27c20460803ba777e55b8e29b9a678b67c6d6ef7abb82fdf976ef56eff535664dc28ec94b8b78193843be5ff58c2180b9559fb14749e9b7139d83fe2cf9fb375f134dc51e79831d932aefac40aeb83e006679952f95820882de19027172822cd6365be331fc7a54bfea837277410c0f81362518967dbafab318c820212ec5515b4e7354d15815c080a52f31553a5e9081bfc38ce19ef227fde8e05d042146b2dfe0bd4cfcf927b73cf3472ea8718d7d4c62753353ce24e64f7cb330257498a44260d92e64968e3d89a55c33a93dbe1df6220abbdf6f675febc8bba04e3145fb61ad6f766625535826681ae969635b55f12220339d5fb644dbd9ba8b00d0a4c28b58ccb7df5eec10b93472ed0fe31f1d22be4848ef8b0e70c636a19ff2770fe5e7ee691fbc44820b71cc826a5a4d3995015a26f31ce0d0e2512d29705ff15a1faf7d88c45c7d67c10f5d38672ac69c2442cdb602de3f8553b077c07e39a3fa09a4588667b766133b402da1a77bcaf6eb2df58cd9b445e9eb1537654aff9e8c882e2a1a3e5ed46efb782515c0500056c422994cf8f18edd8c4422944a7fe16c1a59c2e098cdd7afc965af691f582142470953c0fc2e3a9ff2b8c87e483d1c811ce3a92a20341e7c1ead94448cbd49121d96258c657add51d9bfbf10b28710ec4d263da0e1d9b3ae8f09c462b9868e08097be87853408245ebcb6ca11fd2a3a088a50b5583f6938268ac37bb295edc096048eb5631b6a6b40dff8cb7fc21b76839aba5b869689fb6bf0cc19957962ac2d494eb03")
	expectedPublicKeyAt0B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt0)))
	_, err = hex.Decode(expectedPublicKeyAt0B, expectedPublicKeyAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt0 := []byte("000000000000000000000000d1f7b1b9069d4f8c7e623344ad8bfdaadaee96ab")
	expectedWithdrawalCredentialsAt0B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt0)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt0B, expectedWithdrawalCredentialsAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	dRootAt0 := []byte("401d394e409534d899674d0ba7b6074233b608550942207edf7010bbdee57a96")
	dRootAt0B := make([]byte, hex.DecodedLen(len(dRootAt0)))
	_, err = hex.Decode(dRootAt0B, dRootAt0)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt0B, depositDataRoots[0])
	}

	sigAt0 := []byte("ce87b28983973d191d2add8c315115d5f40747726b9f891a439fa14ebc2b31980c81a394ea7b063cfc56eb0dace5397ead8b20a7a5b710a6a27a591e55ebdc05ebf76f99be33c54286c95222553c61b456c17d04ca2fdd35c501eece2c59eeec3fb12125cbc4db652c03463ac3c5787fa90bc560562a6264625b33c8f36bf01e3e4aa0287cc4b782694f84f85b9a11377c0b5012695ffc30c410954eb1a2bbae655d480bd17764203b4985780e1dad78ab0ddcabc44908950fc72161d98fd2892e184f48a3f822192e1c33f507eb91036065a364f055e61d2e6b97c5a26a46f9eeda075665fbaf48aba0e8479bd693676ad90b56c3e568688a5ce7b088557de184c1bd77608dd8f9a18ccacccf770d3c948f49f44ff487fbbbc4ae426cbe148620d8161855e54081de688736ca84656956f37d2e9305ffaedb652aad0a5d289e24792bb0d1fd47c394e928cf9f912018c1ff6d09dd9163f3528c6a462bc35bd2e0a7a1ea07723c990443716ca0142f97b9e7764447edc88838945de18d705c87ef717edae06fcfd1bea39f5a67bd6aff9877c6b82c5d05e8f0b76afcf6a9f25f1ac01a807bb9d8ce6558bb78b56c84cdc3f87992164b6bf48fea27368daac4a870bc630faa3cf0d111b316139cd30a963267159edc9d101e099aa91782b03b2d48e7cad4277804261d028d3844a528379f8e79ae191977f314a48b06a980166059db60beab6b5cc4b915ba636558338d889a356a1579dc9ca2b0a179327ce862d14afed5632aa208f19f31d85584c9aa71a927dd1dd19e0d1d4b671105cc042ae0e16122bd31b56ab522ecf6d5507d2cc67aaa9969961ab6510385b717e38f47b979d2c0c5a0a674c9c59ff2ae700a968674d0e426d1e11096e5f5d584f61847e5b6fcb546b44382404aeafe6c5c4ac7419158d7202cd8673df639c2e4b5862e400893df710bbe80df408d7ff869c5ada7d070cbcb7784eefd6169267dc474339416e1d4ceb0112f98d2fbfa7db778c2c32eafdbdd0740d303e3ba19d1c89d9d39aeedc83543e800ba0b64e154fc3631ae62a3ef30dc9ca0ce34c990bca51ff30c3c32bb97c493d4ccbc3ca3d288666c9af345d37e0149619bdcaa1d85d712834ad74ae8b9fd1a8a1fcf258a052e03edc37900f1acc1d0e83af282be03c0b11311322af85f9ff5d3afe7568cc5bf83a3a5380ddcfc82ae0bf8d310542c157753395d63e978008abf96c972ecee65ea568990f6d345e056ee95eaaf321c6ad0e71658e99bbed0bdaeb096abd593c0f7445a2be49ad09c14862006e97e8e10e816f74889e416658c2392500075d0fb66992f486de7d3e1d79266a97fc668ec158e09ca7036afd6cb852c14fd7bbff75ad3526fd3dd71e97d34db3f7c32f7f62ff40b90647321be8e7c2db8d97cb29c65be8de84464348763efdf8cd497801c2a3c86ffeb385bcb82aea587845a2100374f5b2daebe6d3b6281bb3a1025592598a3d79388d12f85343781d6e0a224d67f28f5c5bade826dea9218826a0b32a5f13562e706699b9adeb971b5dfb20fe83d29b6062e9be21f97eb39bc852db7dfaad176e012bc32e92565733024703ed869b28f4b004fa3374af867729ea2556cde4a295b4ecea8424c973efd1331463493bd45c39a27147e57816ca72de3b0b4d88f698ea4e902f058250748f9e5625f136fbce4f6e107e13d1b09350499a4e8c2922b18a3247a14f8229610e6e187562b5c0e40b1c2e9002bebc649590e0f7773e4744acd33863e687056ffd049a456c3af79a17a82f560512000b5f83d6e938d170046b798f4237542355378920f99989c894d9ba46d71b73204e345faf43ad76a36b1da511df3f7134351bf8715d798a3674e956797a48c89046b800ca09b184718bb1407fd5fd37ee9d48f37f8fa2a58e6de7d1b866a4f86c5885da65ad303743c7da1a1f15cdcb34a20daf90166023e0d829fda5679caa488be0af81036830c84bc02228661fbe14cd9b4e42a53414b7b7cc4540db5f9c6d79743bc0676cc46049e5b4b33f55cd745b67fed631b389ed6f9c49c08634eb122efc2d313373adf280102e5243d9525c404edeed94bb4315420a3550e0e55b377163fd6279fc5f3159db2fefbe9b1176cda46b785b64dcfd18c271a0f29506973bb408b7f628a74bb3160d29ee2b4e9008a72b932432a8c10b9a0ec1aaf5ae1d89dc267a3007bb9d8ba01517ca28368b408e4fe3ec3ef6122a69e35dce665d3a22acfb9cf9126ebfbdcf51281022d0bbaa53ba754b766c5de55b8459bfeccd6111c7f99c4513b7f9c1c55f89595efba76ef4adcbe10005cc731225c1782fb5a6e2d15a426205a789272dd9c29d1cc0c92b105b2b8cd1b96011de8bbc753167e3bec32ad24c86a706f7699ecb236d49e347a8d215dd8bd4ec5c3c55dbebad64562ae3b73b6f27f285b3b424a956e631241ce2a4ed9c9455f8af4c528e74d5ff10060c051258f16f8dded7d2b8e1c2c1632df5ad15b1c19ea5340a6b630ec902fe31188e80f10b5e39598098dcf4cef308593eeaf63ffaf920132ab24a4f1e1c634c23cabcca54cb22f5cb2e3231500c968d6e594375c9d0f41252ebb1d5060c635ded5fc497ee95f9c606262ad47b276a7ac8c33b3bbf924facd178485e113345d77166739714e896f6c6d3ae349e7609e1991ac7aed0e0fb8c41c66fb86a695485a4d2a409b37d53e1a7381d10884b8f61c2d1801b9d63985111d15a1c880e2343c6a16e16dc1ac2a377e1f9f7de5657929ecb3ff1e7318984d94c94597b223969a146de0612893a6c8c054434c80b11d3ff3e812d58add8e62421d6b1280ffddf6b2cb68885ec59aa87f436d6f9bf0429cb7d9f0de143d8f204249bf3e2b696b8114dd30598f93bcb3016d9e04b30f48ab4ab93197a9ff5399b0422aebc8e2e1b5f77248838895e71db230ca600d8a8acca0e647ddb6f6e591857122ca4605982b9d1ca1e168d7973935dab58a2c04ac4c194502776ca9fdc4bdb21a36d1d81f15959958661429129bb5477b2fecd0b7108c37807ed01c3ec39812995586d465dfb24abbcbe9cacac393e4f7d37290bd274b68b8ff3a6fb35301c4d07438f6a1b342c422f8958e78238844563645337a24b19bb31a34a826a046a481d1e5e9f2dc4d8a30bef02349cb761f5796350c07fd0271dcade86b7768ffffb8d858221425139cb486724c9e5203519d756134a3b1c9a0bc1bda568647910218a974d572813e4ba1570afa98463c0769956040c413bbd2d34ded0df02d0ec0c1f508a6a8e86266701c57e0879589a5ecd643c6b3ff537a7b080d5382a832b288b534b9f177fb51f472e5169a386ab827f4e71d08295b8f1168288ca86d85d8080917acd2d3c5a33dd976aac17f80f69782f0692ec8493b8d66ae661bc18edc0c0032e6df682546508a221c019147fdea40c965eeda627f9b7b4ed7fe863b2c29061d4dd72e4647fcd30fa246e1cd2df05f093356ede048b1f6f04112f12e681611afbf147c63794cab83ffa5bbf1f1d3f65b42a10799ba4116429c17238b68535f56507283d9a09f177e33dee18a3a367609c7da5af3dc1567912145ec4da4fc885ac940ddfa30d0d148867c55f2fc1d9461006d49f034794c231120587d4b73cfc7bc051001484763864ca7482858383feb0c324106e4819eddaeb066b1e8ba619bf8dbadfaf169ba3f1e1363590c82812442510ff99e09e80b09c993daed9579dc3152ecbc93d3696f656e7b8d920ea573e37e5fc2a61cbbdba0bd38fafe3ea02909d3a601e3dffdc589d58d4b85c237d6d7e2c7162f137c78929e52bf5bc5671335642316e74c6c77e45ff69603b4b93b487cf75967204be6a278e59cc03490b730d80d2624c4f2a731533e4b51a7e781b8743cfc6178509fa7cb9825f94bb5e572c2609e3accc0429ce9b57ceaa90b82eacc776fd46a8ec6a292bdc10a8499ce4454dccc8bf68b2dd788388aa392ba748ad47af9352a686fe7e245553ae5c52e531ee70b730f2d3ae21e32bcfb2e61403cc0a98f23131c68d82cec6212c4422e86f287e218728b5fb43de252879c50d1b450b0e978825bf56a782c830e8da342523bfe9421bd0188dac59c85bc7f0ce2c5f60ff4dd19baec63e714e488e7fc49aafcb6e191c1f04266f5118cc48efa61b2f1c792aceba78f200e7ebaac1ca4e33efac73f4a88a29f40ccdcf5085109952b83e3bc053b7d012275ebed5361ff169a16ea84a7279729a969da3bb40298841184be5c28559811c405b1de76e9d7f5c802bedf848569a8787f2b5a83ea1280898c1dbc817e970c4132316a797d3a174e94d00d5b8a1bba04e9e258f04280f86a6185c6c5ad73ed8e9ccc4b161dac0ed482bd4f31cd298c6ea85439421e689bc24846abce5fdfa49b836adba9de36c05f199e31ee068a51278f16ad7876686fd8702782bc07ea077a441f78d43714acc78ea7ca70ab542cbdd23d94e4e8bdc7f22272d6568522b9337752a584ca998f087303b1529dd27ddde6a07c54cc998d1cfa9f6a6ad1f1c36275ccebf4e25a6f95bb83194afe02089e4c26dc39bb00951fea8046872b0214e2bb8721787b735ffcb353efc6f1005d70ba631a276b655be5127700230c0709201015f38e8de94ec6765f04dbcc247aa9d0af2158411d2bb6c09d3588a37fa7e2eda40180c569528b54c3fd0b15dba727012ee0f5363f093bfade5e0cb79d09650ae219c1df5c3cc8b07dc73983a6641df7d8ef2169183ef10c23ace165cb18bfaf1dded8a4c21bcf047caf501b0d4ce4c9509f5863eab3dc626ee066b5f65c3219873d9dd65e8850349118bd765b7fcd52445956e5daf65b7bca1145f01d0bc7d766d6f88423f8c58a7c283014b16828d1fefbe4afd25a0876138f3a63267df929c0e1f11732088d4795196244923b6068028f64c0b4d49622e4ee191483eea5c810abd4c736464ca443b7dfccef9d24bc6c6886730a387ac54084d9c21ff2c8c753110a5b54d34327c3ea71bfe3bba5a0318be04541f97b0fc46bc260bc8c13b4d381f72dc20a2ada99b31eabd98cd13a677d88ab87e2776e88651f8ee0c5f9a84fb1bcd2fe9c1eca5d383efbd208ee43900cc5998895de4b79f8e70a90e6344b4cf89a6da3d0ddf2423ed6318de3ab94eb7d0d5e5dbea195751681af73d4ef90faf593236ec35af773da64bc2dc5ed02d2a594271a17fa2c8a5558e898e68894f99007ed50a5b7bfa3575c611007728d23a6bd29e241cd6191fe2d3c64815ab42e2ccc80d3104d52052796af9a20471cfe76f5b3badf6950950845a5124d9e0255fd149de31e50bae3a94f1f2f5d2c56eb90f42a0b4acb657e09058024fd7486b21e107b9eed88ef5b43ffdc4c5707dec308a50acf4a04547e97e737a4e71db9c1e1b1a953f19905638d7155c46032fd2d0e728a8979a887043994d8a68e8a42d4cac878f857c15bbc77d7ff252cee177dc76e94b798ed6d9739ece44e914ea4a3e60cb9f43e2fbc3710981d1dcb8ae14683a1d08c82bc976fc65145cb71bb259d44d5b9923d3e9e4d0338a5329a63bc2dd3f2b2c6f94fd52d3cca807c36a71eee7645546a660ad0f36063ea4526cab0096a25286de24be3ecca6a88bb6697e950f52c588df195ad9e7c1c82f81e2fcce96545172f9cb8c7eedefeb9f51744365e55ba1ab44253de3ba5f6e1c4f4a6c0128ee016c0ce88bdc7bde90eb9f6b61239e34ddbaf6e178cffae866cbb77b5b03ae3791ddf9b0070fcca1ce1e64f0fa9722ea3b8e8775bc429ac7cf4e504eeccb44f631f61bdcf30413250abea2a849eb2083447f1622853f229c11b4bf9c62812018aec8610da95a05c59e0c749538778a613e6929ab3ce69597e1ae67139394bd8ed7adaaaaa1c370026c5fc63e273c67c103ebe9d0ff44f15394ac0df306f7bc32050b298eba6708c1dada1877fbeb1091685ff13d1d04ebf563724fe95496af13f405230467f63c951adb068851ed38e6ba5d95356ef720b3c776d30e6ee2be7cd571597e159092b9cc84d0598d0bab23ea38da6965b882e0a1361b83bfed1be45eb8d5af59756c4412c3f2160a9ca190d5c103ad6008e4b2d75e87b614de33b88ba24730e3ba154e1c05018f7e7c6071ea14d9a522bf7e086c4e15021fe5520348836d14fb47749a3bef8465e7a7cdbad120e91b447bbcc28558f6b81a31aa68478454011115378b2195b96732af634d8300c1f5b95ce6443a1c6b6b3c1133b648cacca31a31fdde61c3b34bc9e2f4e175be91f34488f7d5edd71e1008dda5873465f8d82f5f08a8c433f41ecf10fb53786e5724ee245081ebc6e5021aab598a63fca6305923d43bc514a4d04b4ed504d2e06aa03bcfabe8e5b861f4710c2a6656c53e9c0a87dc27bccc85d974349d586806293e635bf40a57406aadf164f8f9fa1abb4cc213b437a92048ab4cf292a3536498a8c9092abbce7e8f80f3168818b8dd0ecf406282c8ba0bec4c9e9ed8aa60d2850616595f900000000000000000000000000000000080d111f2832343b")
	sigAt0B := make([]byte, hex.DecodedLen(len(sigAt0)))
	_, err = hex.Decode(sigAt0B, sigAt0)
	require.NoError(t, err)
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt0B, deposits[0].Data.Signature)
	}

	entries = 1024
	resetCache()
	balances = make([]uint64, entries)
	for i := 0; i < entries; i++ {
		balances[i] = params.BeaconConfig().MaxEffectiveBalance / 2
	}
	deposits, depositTrie, err = DepositsWithBalance(balances)
	require.NoError(t, err)
	_, depositDataRoots, err = DepositTrieSubset(depositTrie, entries)
	require.NoError(t, err)
	if len(deposits) != entries {
		t.Fatalf("incorrect number of deposits returned, wanted %d but received %d", entries, len(deposits))
	}
	// Ensure 0  has not changed
	if !bytes.Equal(deposits[0].Data.PublicKey, expectedPublicKeyAt0B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt0B, deposits[0].Data.PublicKey)
	}
	if !bytes.Equal(deposits[0].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt0B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt0B, deposits[0].Data.WithdrawalCredentials)
	}
	if !bytes.Equal(depositDataRoots[0][:], dRootAt0B) {
		t.Fatalf("incorrect deposit data root, wanted %x but received %x", dRootAt0B, depositDataRoots[0])
	}
	if !bytes.Equal(deposits[0].Data.Signature, sigAt0B) {
		t.Fatalf("incorrect signature, wanted %x but received %x", sigAt0B, deposits[0].Data.Signature)
	}
	expectedPublicKeyAt1023 := []byte("d7d9cc6f6f93a535bdb3b18c2daafe7449b4f8766da05044a1af735983aed8d7023d15a7d9b279e62ce2d4f1ef021f986fded4a718fd6043e0a5f60253f3e196913b5090329d2867b49473ff3c52dd22c55f481e763a27ad4b1431dc116a871ef36119295c6171a38583817a5ee246a29f730d76b68be9b6a3cded4fb1104c4ca5d4620d63e4dada42be5e027bf1d73af19ca6bed0df3057bb9ed15f072ff61e391bc43d89692450b3ffba273dbe7aac1b6fb85405344fa9763dddb02d0a46d559e2df47032bc90b797531e56364b4ce6d6712dd6bd92854614053a98342efed93178b05132370924f17049034c079074330326c5f4378a052aa3e96200eb55582e923821d32fa8ac67fc59c0b51f30d9748907e661b0f066085cabecbf4ed09699b3c7879306f82dc23bc8fa6d065e5c9efb6bfc812259ef6750fb3bcf1888c4b1e44fd5ad4e3fa62cc0ded3d1415b71e2b5bf79a5f4cd2d4ae2981112b0499de2e9bcb3591a973dd79a5b1ff5727cc0e1e57d7cd93775f4424231949c50106f9cb49a2200ef71378dbb5932d4be211738f8138c49f1ff0f716e3ee9c7c54ae9248cdd7c6522072553b3af391a331492ee3471afe566a58f84d906eab10a5ec5d28b2c2ca5d7f26a861b41d15976417d11340559bd1e56d527a02bd0eca42a8d8417878ddb63cd06b554f897518d2b7bafd51dde9d724f76cb338d59b3e077dc2092efd4494ef566f9530fde5b04ddc497acea8efacbee290c2228c270f8bd27cc2e4c17b59ae731d268ec67593723867f9032c7a0bc184dbad9b7ca2e5db80d2bf1898401d6fcc63904f50e50041d9a23ef760137106f6e150f8a12cc860d8a141d5c74bb21c2e0ce5770b4fb8f2fc85bb5521114b3fd24720775e1c880f96a4c9a941b6d136b4bb2d48af64104191641a67360c67fc9b666922043625c0f508ca5458bc63f847da906a89ebd4766a6fea12a985407dd61b94ea586e3ff924a2969546ebd0a052ad61d8db0a2532fda08e6b922371b1c56ce2eedf95d14fbbe68a5b3ae2c24d03352143a27ac53cc4d8fd7bb4eb4e2fb7094f2cdc996dc9c95fe38d1fec36490a6370ec7b5d7e2b5dfae30ebf0e91b6a0f328b811102dbeadf3ea43a09747d943974b4d7b980e262fccff275d6b46edf124269b6abe4d300a7cd50ac1f1a7a1bfd6a10434d56649d67b3cefea9ac826c11da4297e935074432bab3794bc6d7076d5a7c37014b6bac95daa59750babc1b1691e04dc78fb02e402dd3d2f54a1808886358aa9d8c1044a05d94d6fcd5d7693a478c77ef33ac98539e2fd78f98822d7220dd3e2356866d5493bc0fbad97e4edb94bf48f57951b15509c7947e95bd50ebbf9633f3707e6a1e41189a5175a5f23319c9112909ee78ef9ee12c06a6bd7cd2fd014fec6c701829db916367c2534866bf2b06999e377c75de39b528de0c99e374fd41868da53d2f8a2d49905bbcf74c8f099781894df4c7830679e0eae560c38d67679c206bd50aea6565c23b6793e7c7ba1732b055560f8238371ef3aabf503602fb29255b1c03b292859b6c6221faf2d26eeb28781e9904c64da76c9a0f31c7641eb10224bc8bfad7aa4929011c9021ce9d2220fa5213ebf4525cc6d3e6701d89375b5937355a76c6808284614322c76442aad7706a7563d79b32c3f63d274bf78a090b648665517ee53957415334d92e0213f27ce56fed5931e842d547fd31f030c54c1cfd7ea29d034fb74a9c347168406d86c4811ae8310618e3d3a943d0572b0e3a0aa5e7e83d28803086075c539aee838715a6c04d1ece3c711d981445aa64b389edc01a76ca2519bd9dd3e3bfc6596550ff49425a9938f6767788207afde2ff979448dae2f8b6a4ab1c2cc216a187a35c14766841917cd9fc032322b2c5cf2ee0e77bc76368f2c3c21a0b09557e1d3f2e67862f4a820314aecd05886589a48680b5af2e62fb4cbc963e8e111ac3f0443bb4cc27124dd8f9cb2bfff27ce5446d8dbf83e592b5cb90f452fd8feab733d54c0f2bbb91d97b0bb82e7506661b90be6aaba3ed8e2b4fe046877903b5eb3c685c7a9a6c987b631e0290362525829df54fdf01a20b99483ce0e0175907bf16b1b0f0436fac3890a383e1c4bc70c7aaea2cb2b1605c8edd49c9bda5cf38592eafeda5a5a8a623dd74cb1e05a9d305ebecf41f81127de98ddef0bcff6af27f053eb07fca593d513679cecd62daf19701075137208ac8da1fa001e87a40777b787a30fb2d8c7e097c1aeb593bd70fee895aa8769a6430695b929acf2f079d05e42d5c183d49f346f120d63429920352d8a844d34e7d045419389995e530eaffbbef107fe2f334cf7a2ef055d603ee30bb651ce635e00b7f6502b3cccb7caa5d139b2a21d740d5f22b68375b11f21785efcef340d30dea2b81a1520dd1b453b6e48eb84a6df60ecd2848acabb33f15efa01b2f340e18dfa4c685fe9593ba6accc56b373dc1ffe3462e135dfe2e05c8f0e9b0a9274607de493a5c796528f76ec6c7d19a064a6fbd0e851a35720aa7b7f298f89d0723a3172517a537235c3209a09bb496cf6985dca357c4956cb777f8a41a4a271313b081076c40d47be452b9ce3ab968568b2f6f2bb7cbbeee4c448b0733c4f147e2ef4bce0054e84b3664d810b966f9e47d365cbc45cd6ed76732cdd9c735b2c9fb2e4c83a6bcd234eef54178bb50119f9df15ce0ef12b47db9da98c97430d3437a23c847929619a4f2e9d450dec4672328206abf5cd0a6fd2086610babd2e133e845b819b11c896f89fa0ad55913259ee778e3461abe010bc0215c06c09f330a4de022efa3ce6fa40f46fb3b4da4bd6bc08a76386f3cf1c1c79ba282326eb08fc62943358dd215ee3245b4d96ecdfb883a49e30052854de7c5f68c56faa1aad3ecbc6d891662d181930f74152dd66d691a4e5df829f952ab3c9ed99f4e045bbbbc73cc78f7f516dd7343f8a4755901ec20315764dc52de88f91143827f85b72ff2dd9ab3a19eba81381b53c6881e201ae324acf0d14fc6877da88c7c1ff9d931a459d6af0af43edf4e693e0462d5e66c08e9100deeaf88143d7a987ec3be1b2f17e3c4d2f2a6e4dd98e24859ba46b363cef8aac8629d5decc2f162971b9ef9dc4a4511b0fcd26ff8b383eea630d1ca75830d9973301015de99b82a372b747354dc975e010c9eb69bc8939fbf43ad59ed5065ea85582102aecca7b9c2b3011e71b3618902133858c69e3393067d1d4d8aee62ddb39c5d84107528b21853c72fe7cc48c189dbeddb4d355328209800a39f94f97fa2e6ac607e85450c2ba3aad8665f18e9e3f24855d0d6f8577d7b46b291316913299a2c219c8ef9eb05f1b3622d73fae3232cb8b7f795e76b8201632e1aa50c2da06474228e3654a07d4ae39ed12293271589ded65f668f94a44d52cf8716cf2e6988d1ed6ddec46457d38234ae5b3a863658d7305aee0818f10cc39e1f1c6ffe5c669f2e875bbace3f96f07d8ad6036512d2f308c8511952233ff7d7c8a32d611e800d1f78064635af0e0de0b11e24a6e5b8a442857b6f3199ec80d266d2d50814780d621acbd3143cd26b2ab26c23ce1015cc5c2bffc0b8d72b180834cffcecb5e2a2f9892a5dd5596572f72f9d9fb962fe8a324948f4ec21bc5234afcfe")
	expectedPublicKeyAt1023B := make([]byte, hex.DecodedLen(len(expectedPublicKeyAt1023)))
	_, err = hex.Decode(expectedPublicKeyAt1023B, expectedPublicKeyAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.PublicKey, expectedPublicKeyAt1023B) {
		t.Fatalf("incorrect public key, wanted %x but received %x", expectedPublicKeyAt1023B, deposits[1023].Data.PublicKey)
	}
	expectedWithdrawalCredentialsAt1023 := []byte("0000000000000000000000005c1a15eee3965473e8b2207bf0060a81674d126d")
	expectedWithdrawalCredentialsAt1023B := make([]byte, hex.DecodedLen(len(expectedWithdrawalCredentialsAt1023)))
	_, err = hex.Decode(expectedWithdrawalCredentialsAt1023B, expectedWithdrawalCredentialsAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.WithdrawalCredentials, expectedWithdrawalCredentialsAt1023B) {
		t.Fatalf("incorrect withdrawal credentials, wanted %x but received %x", expectedWithdrawalCredentialsAt1023B, deposits[1023].Data.WithdrawalCredentials)
	}
	dRootAt1023 := []byte("589a3300133b62e0d7b1f99743d25ba796423bcb4b7f5ac8f981422a23a8259f")
	dRootAt1023B := make([]byte, hex.DecodedLen(len(dRootAt1023)))
	_, err = hex.Decode(dRootAt1023B, dRootAt1023)
	require.NoError(t, err)
	if !bytes.Equal(depositDataRoots[1023][:], dRootAt1023B) {
		t.Fatalf("incorrect deposit data root, wanted %#x but received %#x", dRootAt1023B, depositDataRoots[1023])
	}
	sigAt1023 := []byte("a5b90f9c04a3444e284da9450051b8f09cf8138ac3610e9bf90aa233bce6faa27850f2e910f0be3b54876f2ae2f46dd5558ce5b647cd93b0ef3da562dff71e175759bb02def559ad94a3e1a562e71fbba21dc7363c056c99ec488ef9ee5a7b094350d8d7e4e64b619fb0b5a44b3164769052850ba29d93b6a290e8ee5cfd39b4639cf0e0c711ea36114547b51b3946a68b544dab0080a71773cd406afd2861d0bf74a12adef87672298d4edce462c78e9b855b14ef90b703346788c92bd8a6ea3201eea20d7d28463b6d712d9acc4175c858c5e8f8640db6f736a4c8bdf162dea18f78ea400e6b9e9bbfe388761522e06af202c8fd5b6048ff1806a97bfc723b5b26ef3edcab8776588002acede70f6faf36fa7f9fff01a609e5862ba39a5605e941b498075a3e86cc67b37042ba56f4653c7b3abb091e4e3a2f74589f062c15ed1bcdbfe41b790126cfb2409709783fb7edf0feba8161c2767afa0108640203e0e2ca518e294520547b652e348a3b0c2d20195a441d6c7e896085461e4f19239d036a20a76876573c82c4969b2a090bc6e95e2a01557a90956e885e147ef9bb1f6a792c29986f4bf678aeeea3658caf9761c41eb480ba153ba4a32229164c204ade244ee0bbb27feb703688ee76d499e5345fd48e0e765799188f1fbbf72931e51e16bd2af65b9b8df280b4d197f459c2d6d18fe94bb8e820efb7b9c5d0bbd12e58e86ab493d59dce8d9e1bdcdba312de8908823b5b55c8c46175bf5098441aa6000935b81d8261039ce9876b72c100d1ff8bcae2d7c984ff7675d325c7fbe76938f0847c144a681ae952ddf42a08bad37169080e29059f8dda88a7a0d5ada381bc13867bc252b439ea7eaa1a4c4efacea74b28ce9f9f51bf71bcd6c0c37b868e786d42c1981f740639de79e347df27fa6431e538c8f878eba792654c561a4724d52211d17c445e8387d2f85bb350d0a0b3c731de12f442dbb08f4c9537312ceba2bf346e06ec67b8609005b27f13bf7abe0a3ab9a4d6e37b259a6b40f49406114bf503a57c66858678d4b299e8b9237b461b704011212a8329fbf2ee0403c622f698164a1c2fc151cbd3bf4e775a82033ecda3ed9ce27b7c85ce8a41b0f667acb87135416223d6313a9d8c29367d199b22ad66dd787c94b452fb58a59ec5fac332fcfffa031d245ccdb751fd1c644bc9b64e9783452b86ae805c15dccf7c41b8f25291e84b3b725ffef84ccea46974152a4be2ed27df21e3474e0788f6741e0d72966bbe3dff5e0f7389866a44b59fe0ec453c9c4afc258c53b1d08a2fe092a824e79d6ebeaa3f6a4dbf4b162e2fc1bf617f2a469e5ff0c0defab9f3a476e301c9319726cdf78dba14c5a17d0c0d05859a41fd6f8b702ab48368ece5bfb524f51163869d3426b8a016d00dee08a35d80beeec4655ce68ec701bb1c50a40962f7fcc3489a43a1c93ac639be46a81caf5d47cae2264515a32c552cc582cd5b6ffd734322b0d3946ebf1a925ff7368033992d20b739405682834f51b9d6fe022f1e14c0e870a935849675a8df4fcd117c4168373e258786563a2bc03d89eb38d3ab52ab5b9bf625566cf1bf81bcb1284650c195191fd1cc6b38edda6032046022ddcae73e1a296a7c53e773335d1f2cdfdfd70a2797729b216d010aab4aea81e30b86d9ffb812b6568009e8a85c5d79d6fd314a82e0d87b5a5ca74bec14b85035a04e93b18194e2ad84543996c57b8a4647217d001fad0b7b073ef5eeb9c037375db1e51796fcdf0af3ad8a75fd7b83ec40b3cd2d845bff6f8dea174475204ccf055a39fefa46138b5703fc31c046a42d85487face743a434102a3deef5446d32f5362c1ce8ee9d99f880e8776d021b159beedc3b6d1b4d7490d5d7e546466a88f8a6c750ec93755458f780962f1d9c1908a36aa3963335b4f484e34e4585755d7aa3d715ca54a6690e74093c55273e12f1f6a8ffba0bda7df1fd61517bc338116aa0628ccdc10cadf6988db79e72802d5c5d392a8add434b8fefd2e611b2765dcf5abe0393f806382f314aa9f34248f9c28e7d9f73daa974c33ed0272bfc1180e074f9c66df0ec640419cb3ff30975769ecee17665a7f3577ac4f68e1d7276ddd8bbd08549c801bf60273e1ae2186201f3dbee011cb6595e3c9a137cf17027a35ebd8a8f3c80ce2347a8496cd89a6b0a94c9fb3f373ab0940079f7b0109d478b7708953f87543b36d7ff124a215530b9d03566bdeb58f8d355504c1ef63c6e01e80764ce07040ea27ee02c3c60367f4d3bea5ccf4514c0d34528e95545b0caedb4f3ca8ab51e779b3db0e04eb712d5fbe104512bb0910dc00a1508de7c032f7fb093e2eb1673375bda23ed87d98953f856fe093c015e2b4861f4862035c218d8fb1c89bce82fce00c05a68868ee33692d49b23a3d42a320572b42d63c374e995b93a19f17071ea6221a90443048b1fcfe81583cb4382eb5562331973612d315c8627bb7cb8da0054aa795a64c95a2e69300f0500bb48e21cef2fd2a9a56c5df8efc29ef384ce6e783dc821eb12fd2dc6c306bee9817a77b4e8a9b6bff51cf8885492c1583ad19dfad0d9c87218e2acbc2cf0bc3ab37f435eed052a2a424009ee3e76f2ca72de4fbde7ed58e3150b0e3f882d5ba2db9c5813ec018a8ecdd47fce3ee0f605d416a0d98cafd73c0ab19666bdfd3054c14259e88e4c8a6a1b922c82b661687df5140bd98c767c7d6a4a9aac05c4f9e11bda37517b6ce97dedd9625bce89859b4438d995b9d931c4ba1418c2393d53bb888559d7219c70bd0308439357422621687cdfbbb9e18f8a63b5382b21561bfb6b2952c521688a548728ab6470e003df5d8b7a97a7079b8b2a037bf0fa6e5132080345e3642d7620c3198c76d28ef9e45fa851d68440d0dbd3cd3924989a63d176ef2d987c942e84a98bce8509e21cb48a0e98a76bbd507cba0398f57a59757ac2a1ed059ae95f906de02cb78a3528a9ded62d47e3473ddc1573383988b4561626e5bf752c21c1defcba93173421e65bd32b239746bcfea1576cf2e414f0e1d82009abb2206ef9818771caf985afa263ad101f178f2e16ce8dd75a69de98583ac8c188268b673dca92b300ca0718f9fd21143fa64793278f89cb2fa00c2b6b89ba6be2a703605ac7d0d79c8934a57176fea517f75be9e74ee0889bed2cb8a7070457ec6b1ab1e0a785e5788ac74ab9ea7db41b12504adb8e1c0d41c97f98b7bf448931bf26e2c0def3f1f9d49fa90e5a1e3572a0abd98dde5883beb37e23a5f6380d2b8e08400a86a05a33e709acf6735e19434a31276baebf16f34d7fe921e3d3b540d81504655a25b977e463b77e194b5e89e34c1d745b6d650c1657de2efe435d0311cdeef9cd3501ff6f81aebda023ce6c198f98e56aa79287d771931ff74faecb5e4ec95293862fe6e4b0df33859a568465d4a51c93b2bdb147e57568832456986ceda4c394879e2cfb6f8506720a59a37fc766fd0abb3bb8a177fd9915a64c779f2cfea7e03ee035219a1c0280dd5538ff9cefebcb8cda48d84df27862fbe14f8befee081dbbf2779544f5e0bc972c44c9cd9ceebb34574e933645176ea87676a9565af0e055d04cf1f825b100851c8d9fda2a5311254ad346c50e729fa880b354fef67c7c2f29f9bac17f2be384b97b3d3402d202acea950510a3d7a85f48b36c144cbe862d04cece7bfdf11719edcf5a0a49fddb87fda641bea716f7dcfdf4507b42ba94550e34e6e329edd55e7e7ecc9daabbb0d9598d6e595a13c29673ad720d7162446e41f0d2fee86754682324e038c29cadb39231602d7b3e83b2ab92ef12ed1013fbe22a1c78628ce6dc56eeb65b9c52c2a2b34878f45f7ec8e2852eae8a896a8fedde523a4c4e2046d4282ed4484c7e75019a457ba018de8c76401e65df2bbda1f29f8cc677edc6b28d6c8f2e3384d530f3a83245352a07c0a69ed33f3c0e8076707b95df274a1f1ae011573f917281262de048b85a7a9c27223ec12ae42dcca00a2684c7444bcd5fe22ac2db279360b87071c204b8ae812dfdec9c8f202be76c55a337d394016a4394f0264ff2e1f82906315fc58acb88c22a28d41c1956677d7fae5927ee85208b2ba6577e01005c440b5f225da0a52d75156baa5f76854ca9dc5399588a86e30e9ffe9b1c64d396d2e7761fcef6702fb11eebf9dfd9f40e4bd6517379c155e6c00afbdd897883273d1d1deaae403f5fac1f3d98cfe70cbb33557b0c94dff1e3da3aab04729bdbf6efd8ecdf24f768015d5be7947590f8ebfe7b81e93e75ed50795efb31939be7ca48de28189d57fb13b9302fb9e008b84998a2b9aaca260f7be49fc067588f3c64cb38a6476d685e686468a801746a755d33542c5c923ae216f56e32d6b313fecaed6cd7db27f983b0094bd1c609dfb4e82956449700aa5760328459a3dd1f14c3a613afd99b19ccb449fe3af10b04efc17c1a71190cd8f1e99a608c50290ec533c4aeed8c86f6a8b31f313635c661191c7a81687dac84e6d7f0cc11eaba49736f34c16a2cef0e1d772d232a864f55a7b011f0e508f2d8d511af1bc5baa6401b8c2c1086c2a5e14163a335e7ee703a82311f9834c4167382c0cdffc19ab44961a888d2245cdf5699134cc1d58fd0ffd87d00b721f613e7196dff36b080de0fb886e5defcec0100595428d3411b7cd2c8e045643cbc3839dd088429ea739f551f61737b2ae00402342f8f34d00f5a8419c0f0f44994ebb072ca79c43c89e692d3f30bfcc0943727c47171d0f7bdb898caf8d4e11b6b9020adbb5b1f7069241f9b4518953bca3239fcace4f9ebfcde1f6d32e3eaca84fbb4d904c05399c162e12682f1c3338272808a7e0f0de21c0617f57789fb9f4c27c81a00ed2b844af9291f5552cf7df2fee4a4ea7008cc70cc12d65488a6964010990a0b8037d2f35c086f19c08af1a52b61ab0bd080d012d4ca3957a7aa7fd40027066de6a04e1d7212e1bac2ae10ff382d26ee0b81df2219a783b06443e3d827cb3576cffacbb5ca9ecdd116b601de87a1a38ad49823280a03d681b1cc3fa2e890358c567a215a269f2a1f02667d7de359c137c62a504f58148e9d9dcc78cab5a135ad73b633c4d51689259f607d04669d8fb502ff51ea395b33807b475184da81cab80fa6dbe1ed6ea6c7eac3a156adaf6c0c718b23904d81f89beab48655dcf4666d48446ae660f3329cfd27549a8b4bd3429d4fe410dcde15312c3527230b7f696ab72b31eefb29a925b2abab30016881e229ee93216338a9ed70b9e1a1c9c7f9f80de9a259e7dd230e7ea8d58bd94f74c0784bf37a38db37c1600d512f6e1340f7fe6d8b0ba591b5ea9976848ea85432f858fe1108fc6f75eed87389460a7a8ca6dcc01c071f2184e4618a5b448802528a24c4f45c30bfff530f6eea42424f1390d1782264a260255938c3373b1041f5addc8d16cc6849c2ce79c1a89c9f8065ada6ea7a7ab5afb486ea22bc2f461f2dfe45005f44a682fe02679953d146fcb254cc6e085d1c96f7363349bacd6beff5993c603421097d2ed93eb774163b5f636323eca89baebd31f7b0b302fba2f6548dc84a4905e1db7a8d251fbb282492c846de5b8d3720530c09d4a5176d587c33e6dad44eebc14eeaa86a4639c956ccee69bf4d881f9bb4b480b3be635d098f034a008b2a2d42a7d7a0bf6dd53431c2e0cb4daee25e23ff1eff04660342e6d05ab03b9c263f32433bf0286f6f9b34f28d6fe67cd501a3e6afe8ad6dfe7082a7c34b666183585526e37e5a38880aa3b5a673b07742ed9b0648555e017a077735f206521aeb17ef77122391106b42adc06e3010b18748dbd3760b77316e16769cf08a4fe014d62bd1177f33dc40dd7da8622a0b4af72208482184543d8141797e41118f52897af5a49f7e300a490af278995fada45e783367c63ab82dbd13b940ce1758eb5faeb78d9f33413e45b19a854615cf39e9ade4713822343a5ec769466b616a9dbcfadc571a8bafd9777137d8836527ca57b26a28cfda0c29466e348decad48fd10097e9575e046feeb2f819c6704e49e8e909196da993c98806f1ca85d07c91c29ec4f445cd520e0ace1322f19fa51c4e630b50378ff0d059bc21cfe60abe8ebf469aa8ec033744d4ad7c60517700139148b2f509c85cb3e5631ce60b30368b06ba62d34bcffa875362c1d13f0fe7d797e38d9668c49b1b5600a6b7d3f5929c1f0ef31120875401d7d5a75c34b08d4efbaf7d54a376916cc97d57516e8ae8b8d71f7295d773d8c26d8699f9e751035ccf8c9bd08b5b351d521ffb8f93125e61c205e830385b17b75d71add2adab772b9f3d465721a02e29056681570f35b9da3b4bc1b0e93cd5f8feca7843984e4e3b0396ed452c51f1ea34b826425fd3f20e94bb300835df1035f819dfe203ab0bce2e6f9fa8ea3bdd74a55747eb7c7617cab071e2d5195a12e50595ed2eef601174e7b85ac305a659b9ca8b2d1f10000000000000000000000000000000000000000000000000000080c12151b222831")
	sigAt1023B := make([]byte, hex.DecodedLen(len(sigAt1023)))
	_, err = hex.Decode(sigAt1023B, sigAt1023)
	require.NoError(t, err)
	if !bytes.Equal(deposits[1023].Data.Signature, sigAt1023B) {
		t.Fatalf("incorrect signature, wanted %#x but received %#x", sigAt1023B, deposits[1023].Data.Signature)
	}
}

func TestDepositTrieFromDeposits(t *testing.T) {
	deposits, _, err := DeterministicDepositsAndKeys(100)
	require.NoError(t, err)
	executionData, err := DeterministicExecutionData(len(deposits))
	require.NoError(t, err)

	depositTrie, _, err := DepositTrieFromDeposits(deposits)
	require.NoError(t, err)

	root, err := depositTrie.HashTreeRoot()
	if err != nil {
		t.Fatal(err)
	}
	if !bytes.Equal(root[:], executionData.DepositRoot) {
		t.Fatal("expected deposit trie root to equal executionData deposit root")
	}
}
