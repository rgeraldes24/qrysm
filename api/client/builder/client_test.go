package builder

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"io"
	"math/big"
	"net/http"
	"net/url"
	"strconv"
	"testing"

	"github.com/theQRL/go-bitfield"
	"github.com/theQRL/qrysm/v4/config/params"
	"github.com/theQRL/qrysm/v4/consensus-types/blocks"
	types "github.com/theQRL/qrysm/v4/consensus-types/primitives"
	"github.com/theQRL/qrysm/v4/encoding/bytesutil"
	v1 "github.com/theQRL/qrysm/v4/proto/engine/v1"
	zond "github.com/theQRL/qrysm/v4/proto/qrysm/v1alpha1"
	"github.com/theQRL/qrysm/v4/testing/assert"
	"github.com/theQRL/qrysm/v4/testing/require"
)

type roundtrip func(*http.Request) (*http.Response, error)

func (fn roundtrip) RoundTrip(r *http.Request) (*http.Response, error) {
	return fn(r)
}

func TestClient_Status(t *testing.T) {
	ctx := context.Background()
	statusPath := "/zond/v1/builder/status"
	hc := &http.Client{
		Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
			defer func() {
				if r.Body == nil {
					return
				}
				require.NoError(t, r.Body.Close())
			}()
			require.Equal(t, statusPath, r.URL.Path)
			return &http.Response{
				StatusCode: http.StatusOK,
				Body:       io.NopCloser(bytes.NewBuffer(nil)),
				Request:    r.Clone(ctx),
			}, nil
		}),
	}
	c := &Client{
		hc:      hc,
		baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
	}
	require.NoError(t, c.Status(ctx))
	hc = &http.Client{
		Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
			defer func() {
				if r.Body == nil {
					return
				}
				require.NoError(t, r.Body.Close())
			}()
			require.Equal(t, statusPath, r.URL.Path)
			message := ErrorMessage{
				Code:    500,
				Message: "Internal server error",
			}
			resp, err := json.Marshal(message)
			require.NoError(t, err)
			return &http.Response{
				StatusCode: http.StatusInternalServerError,
				Body:       io.NopCloser(bytes.NewBuffer(resp)),
				Request:    r.Clone(ctx),
			}, nil
		}),
	}
	c = &Client{
		hc:      hc,
		baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
	}
	require.ErrorIs(t, c.Status(ctx), ErrNotOK)
}

func TestClient_RegisterValidator(t *testing.T) {
	ctx := context.Background()
	expectedBody := `[{"message":{"fee_recipient":"0x0000000000000000000000000000000000000000","gas_limit":"23","timestamp":"42","pubkey":"0xe0a586bb51db522c31abcbce14e6cbf6a5bbc7b3331cdb76378ca1b98acff048c11099c2713f229c349c430a6aa5623fab8d39ec266e0e7d81543fc2e4b905ec7fba75b9ab3aae53e18e2a018297ebe4bb2d0a22bd13b60b938461d922ec81dfe152224c51abcccd4105799ee2b70b53cf2401a3c01664c20ab368c4c3ccc764be5063488750f79480adcac444e274fb46500aeb2449d2a81e44c3528c70554a9ecd5b25b39550d469a43f5ec2afce668aa6598aa1c5618e569bdf08ec700a21950d6d2df3337ff196b6fcb53de94e7e127dbd7edf9c5df70c41c715b48cf4e5ab5d0e1bc4d9ead578150f98244ea47dba29af25b12a72054618d0341ebbae8e5c61cf6583c0151fdcf1323ee3cd65f8f739dc621f2aa77f8dfe36a7cef15162972c25a193bd306918deb8d6395367586ee6a534340c07caf6496dc393a0189cf81325499132a012a2b8a6152be3d3d010aadba896af83d9d447741a66100f72da46c9282a8a9af5bfec0d84d88882ce0a090147dbcef2f100f8744094a8e3712c26d875996f56a92fd99a39537197f0bbe58bb706061426e62406a300626f64b7dd813c756c159cea82a6cf82b9890be40284720b9aa9c6f1a3a78bfb8607b438ec3665225fe21370770cfdbbc20ef6525362d413ab23e85d5f6ef38a43b44874828137ab977dd9a145913ecffe2700a225042b766158d26288434511014928efdb857df4217430e18bd6c370c8327b4451611c66a118193f1155ffeef32d9b26b02d04cd083964f53b59b5ffd02789be6e8aeae4f615afb39e53f5cfbf3d9ec23640fea711fc6751abe9b3606959ac12aeb827a76a515f27d0e0f1e003e00a91a1d20b97ecde53202d6f9d61a1d4b0bd7d4f0622c2a90d67ba40f59a450191aa340bcc7b3b3107830ce1fb791a97930fd68c6b9ea0848c0591edb0a6302e0984d7f096ccb980803bbeaae3550d8996a001ecba956d3c2bb20eaa33094071e639983693f64809e449c29b59bc0b4f1530ec273f366db337bc64d95a9e26cc21ed0685cb2c606b994505bdd6237dfdb414df7eee7544f34cdf5f0e6ca1e5280b493446cb883413e26e06a00354bced7a5fd410fd92ffc39443d9e8f208aec8d81d958c060203bbe75db0cb2b982524b5e91135d4ef671ebe6c55c24bdb00d89b78c7d8fed674d1fac6d6d61bb671a996d3efe27a254e40967cb60c3c7ac5814ca5e5768f268c7002ba200da9200fc5498d07833c4b25a111d35f64cd26b108a897616d4324984e0833937344b904b964d5f292eeba6075987b5cc092bd40697ef9b2ea95cbc1eed5bf3f6337145351e98291853c3bf75eb1a533817cab5dc8d87abf034696e8dc9ad20089d79086b8608cb07101b62ae744beba3cc71e75701d46c35f317ecd1f3bb6d6078bd8cf25a55bbd200d7bfb5c9e3e2167a6abe8a6636ca82bdd63c3007b39d9a57b9f258ee4bb94325b20744087ba3a2bbda513ed067b003a0d6a4197bae5776cb25899911f92e3cdd779931e98cb11846dac49480af3c2fc3596825ccbb7a7dfa3e714d8fc809acc57577dd448e477bff03a907f8410f2ae12a9ab4a3d7738315c07f42e5af416560aafa035ae4d4b72d5e59a45dcd4c91000cd8cef454c7a157276cb2610d2d08a7bc90550c85e317fdb2d83ee26f49198dd035bbe39d6eedfbc91a1cffb5682f0410204c281f3cb8d702258c77214d77e92f1e5f4db2a6be18911c5f3950a3228d1850722f4ce0a5d56a8acf2e0311290e1334a2bfbf1251d6cb46f2a028aaa7be144f38fdb222e8a2d6320f98796731847b2449774c025a452c72dfbb9f05959c88ed86256f5fcea5458c3e22340d8ad3c3ff548f03346c55f74d6ab3aff1311a302bb8c5cd55b44528fd08ecab030c1e47385ed27de5819fd798ada8858462de7fd55aa7239e03079d976669e52ff22bf9ab6fa4860064dd5033ca6ae1fec5c628e5bc2b190ae5483514d841a25b04d127d9c536e32f3bada7b46cbb14b5718c88ed826a8c19d1fd43a7f7ff6860a88adf9fcf1415eb2c56e12a7dc6a73e24bd7cbcc7fa39ce7358f20736adc11842e72a5107bcbe78f56bb56fe403d51ea531d7d4f2681fd05f5326d7e5dd7e889a3380f9dfe8124d8f258d6f9ba6f0f6467e787d996da6310196a70f551e64d1a9dc51fe907227f43a1fb54a572db183edb726375a7a1096daeb8d7b069bf8886d282dabdb7e9101fadcdfb23c57be75a193cc3459401d14836d250b197e6ae0e4818b2bea75db388bf36f311eff18ac14b9f0fe1a354d8d397439fd202d61d545f430676eb16c6ecc4c3f583fa8767d65cdc4f3155af47629cf1b0b833a12391b02b1781f1c31cb6b05160241b1e02c5889db631ad2fa905d608b2831b45529dd7550d5ff91d4b7ae23533b1f6875b38be0f26f4479cb75579d8612ff2cfec981344598c76054584f6350d296c2436e2d43f184556d4e6208483e010ba8bcdf413d659fab3353bb8f53f085dfe24910f28b82ae382047383e81922f2d05b13d073b3fbb8042c9c1dd6a073109afffac32117a6b4162387949a9c2b21661eb321a340978b4c43dcb8ce264d6e30751c1e91551f4c2efec349bf0f083db63f3bbbbc83be7eb044b17a7fbfdeedbdd80e76580a5082d7534cea34620997ee593fc0c725a9cc41f192cdcb85d2021f2dafea48f14f63d01329845c0533210075ac3d1b674a5535d37c5c5acbd8fdee0ef9d3dc66b9fdec661f3ed53d1c70c825937716af2d44510d07876b3d52c063e7ddca41faee15d3b81940dd50d41ad5791b4b37f44cecc11db9ce58c7555491ee822e8ff1d8b0dac3eb409f8b827561ea6b7d88af82892a53ff2d239c76a8a1a717b101c7b9d7db85a84a508276b8d1ba972d31089cce5dba3ed722ead0849d336b1002f41f1b1b93d2a7e56e5c222d21327d872534aae80e8f7020c4fda6fd4765bd94df4aa38c51924b356412ae0ceff6adfdad9b9c793ee6aec73a902f658ffd6af25abf374368e38a8b9e91b34d2eeca566eb39ffa67978077870b21279afc7760f38639ad6fa152af670f25de919fcecc16755bafff466a0b8d9910bf84bc5917a33ed76fd62c47a9a2ca68055668a13f11616b7f95cda26c2b09bbe8c83609af99ec41470bda5b12524a849950caf6fb96d908dabca97187858c83a54cb2dee7fcabbc0fea8d3ca1b860d1d7b5eb1dc2a687330d2fb237f55d97fbab4694e4037355548f1c20122da77eb0b7b90205989bb9ef52f76f88770eabf56f5d9ccaf572b3eadb7c9810e93b675e7e9ea26f8d8749fcb23c63993d62406db2a53996dc053e698e70360492e2c467e1baf2d76a9dc74f23c3be3d27685c5fd07a30d2aab3f2cd7fde563e29a3434ee6a51f795a5e114a3d6259732362126da789d82ee54dae91c3e2c060a4f79943068cb6a3ee5692587a67816aa5a9c5ff3805173c72a5ad2b0ebd8588253bae50da117d938901f8ffbf725ced16a76f9f53d782ebe1f0d6f6dfdaa4fe8f93ec6246b66e561c740fc7eaf6c771659e90f545b9e89221fc9450543424f0a14ad7484253251f658e56cf1cb161b4cee63c6c5b96cf8c06e6aa524c8209205de7fdbf1e233135755ed6300ed4c096764fe4dd4855f421d272cd63150db47bc6f47bf624798"},"signature":"0x23b7f3eb8de34c192a57e259a4857a62a1f5308f949fb0de8a6ae80934bc925137900f1f7f58feb511fb6b9800916b6c7042cf054ff6399362190d9e2be45586a72ab04818ad69e14b5f6428df64482b92f6a4e83af0f22a4f5e85db875a3c9c4ffe4372b4950d40d88a12779656c9454eaa01d6142ab9fbd8adb8f4ec7faa88152d4c40e849bbac1241f128d7c4d46907f0bbbc417a8bc6255cd10d306a42c022242f9a6ea5241a11d511a78872431d3dbab7275830c8fcc30abaccee67aad87ed1e97a7c611ff17213b4ef4c720198adbc39345808835519a473dbaddfc709369570309141eff0690b130074a81634b054c1cb3e9da3bc0489bd4299bb553021d42537ccf8bd09d5f36dcdbd1ef956d1c35534e9252c737cdb98ad4f70b52651c450d20583f697005d881247cc2927f36027fcc10f7fa841496502d4137b110dccc303eaabce693a0471b1ffe369a4dd4fe718721fd47a1c35a59d230a54b09becec6d6582b5d617aded2955ad786a24072a5ff54e70ca885a923283fe64cf0305034c0dc52d92cee1e9333c5a38e1ae5af60ab3f9e801ace98ab069b0fbc18600aaf121cf4bd74af25c001a452c2b562205a45e9fd71346d1bf8b7f56ff6d0a3acb4101b3c625c5d57d576a3c68c0db381b46acaa0adbf0b3df9f2e82ca346361fbed145d46012daaaeec0d6605351f1d3fadf8881d2b1d0503a55a9b6d62e013f9d6c3b2d6c69b2ea7832795374eee680a3938b671b1672be12bccab41bb3b236c11323d3e0846eda85dc8d012f0ac4ce7c9e8df4eb92ae996d4829a139aa56b26c263d5cb6de5a174cbdff23c98a7880c89d199e56148cacc03e6d37b856cf470573d071f5049f7f5641e9f01da2bc3e8b97afcd5fabf8791e729bc37b0f0f0f832c790b4ac88ce30e72f22ecd2a2d99b4d499c1d3991014d976e111586d4c141a32fa4e79a17cf3697636c59ece30858644a64aa7ff91cec132de6196b16c1d581ac23fe059ebfdd012f2a5f5e2177c914140c19f4ba90d744ee01b39ac74494e0d80efcd9ff068ddf576c3e1125daf5b7da6a3de542983c02f74d584354881dda25d97662b6e494d7dd30fcd3a8583bcde25080ba2f599784923bd7e322fc582bd36a6ca8efd18f4b0d85e526b96558395c72b3893874925617c88b5bed1f159f2b779c10f1e020ecdcfe483a58f084fdae8b6f87a9b7bd3cedaec2915693612e8e6a20666d814b01748b708b529a6392ead7b9568ea5188eddc848ac40d7231abac559b841022a8fde966290a6a233fe77cdb05ee46967004e6993ef666ad07da213e2767cb132a2c4d544308d95f02b86abaf1db3dfae541eb2a4d163a18f123807bb4d8ce674f58eabebe21e8c155d7a8f883136af2567d77e35ea248a4eefc574089ac0aae4c69d36485ae6afbef2235f383efbfa7c8eae6aa0cb0dec23fea98c74dbbe69fd04ca2ed4a8c3207b178abf39b217361c6c981af38eda178017ccedfb6c42b3b5f52645aa7399197c8c4cef8662af996b1483b03fc0a8d128bca221e9ca5c93a9c4de167c91e8342d340fca343ee5bae69115a914757c077957e5052256e894e481177834d084a645c7fa4c7d885bc8e33d7b7be9953fe6a8a98b6d7943579b3dbf23c3d4594c93b951a7f27b112a33264844df1e0600857b30e5863cc3107a642988ca210db0ec09adc554945d1dc3dda6b9ce7aa7747ed39f3eff0ebd63153f807a017d5ee1b5b5358f8434ce7c8a65df9517aae2a4582d15e86cc6f14cee3b6fceb9466c76f6c8ef9af0cc9fde8c4205bf8804d4a5d916b8ab75c9a3004977d7690b870a8f7292c8c515c56b4887c4431eabda1ea7a3f93acaa32afa5d0a416c2411f1723e544c8e76f470e4a4099f766428b54b68001031fdcd1b2d18bfa72c1b72ff83a44b8ab697d289ebadeea0a5cf0c308a6f8087635ed7df1cd6cf2057e5471f73561f8b6e888388f128766bebc9804a527be652f804e4c176f89d540b70359c2240ef3ddd2969765fb00014996ada33057d4ab844cf4d5b1f1c9cfd51c94583f23bbe5ce1f467b11fff9ba4b3f64cbf76825be4010cb7567072836526324fc7602a713f92051bd15cbfb6f2a01bd3d257e77d08724ddc708ea10c13922df5edf96963eebdbcdefc06118e6fb04cde68f11dfbb69a93aa3889b9fb6cca907f085a52bae555f721c315dea80028f8016d5e203f1b266c224a5608617e1bec9eb3e19338b8e970863d77432bc8aad37052a6f8c14f5efa387d24b4785a9db270e97a500f7d67262111363932778e823ba10f5c723d427d0f917222a8777f2d4af05e9668fd54e70e0dcecaf10f07d81a5860efc5bea3a3f398c7bb4558db6833270e618e8350a3b6a43a7a45e3d13d3f577b06784f535608d804b237b322e020911cde3f5841e672e5ef16cab309eaef0bca69b000297081f3b83dd29c2bb5ec5c673d6fd022a7ae2aa58c609f64cda3dde7d9e810c0e3c151684570abd1246cfd2cc4aedeea932c668629b471dcda1678b60f932213b67982e1000bcd830396886fccda9f01fa33c7c582a1083023386a9d71a7c7767ad9086adcf10c86263e1477a13b32902334af59115a422e064158f9ced4a536848762c3b99780aeb14b780938822dd9c08cf8a8df9accd7796a9266a26d1bfe098fce386b933a5a9f50d1fa61ff4f778e772cf9db7fcce913ae76342ab189d3f0a5a3b9f41c3d6a0128fecc156b97a3459c2249359e5e6387066dd2095ca2836768be8b7e7525a855d28e56481bdb808910ea9a6db004ebcd959e3ab2c60d174f3448933038860c126c7121f04220804bf7f816c5ccac37acd86c5252c657d29eac45ec8c0e64da58d6c9e430a8c0f8578e98d29dd45a7e6ce2b6469a086b7dfceb550547ddcacc0b3a5be5491b4827aa6ef9aca1386b51b2be96a05751bc69154312a21f60069f530195bc5018c14c03fe47e749bf1f476dbfd63235aeab1606526c63e3977f03df6b601a0f8ef6952192ff29801011ce3f809f885b0f46700246c1b53095d8ad98de20c62687fa06f391da2d28e387f61115d332230dd5afc12b28479b8223f519f3042f96a6c49255b2ce74f2d4634c32bb67d10dedd56aebdb1e54bf144e4a429f10950c2b1388f3bec123ddfe112f69c785264a09352c9f3ee436dac1e2ce5e3413e14e47ab1cd178a68b97f99fe933a353e7c8b669296d1ba50426878ffc3a1d616a91964cd92917731108863a70699b11cba6b4c2534edaf3d7482e3e5e6227c4291fe34cb8ce3b4bdb62e37d0a9ccae2fa01c23593b9985b3c2c5eb38b0be17850f244f9f8c57687fdce2f9ce79a371662e75bea4947732c958e30d84f0ce6ed6f4829bbe83e62121ecd3307ed15c73fd45cc3a06d632e34aae6f97e9255d9cde21ebc6dd57595b518544007bf32014aa5cb12cf667ff6f2caf8f9aac790640a9c509afab7ee5335f8421efc9fcf408bf70c270081ebe09b29ab9089eaba87ba409376a887fae7136c79772e961dcd45f8d4df1895d5bf109ecbea093c502ec0a80ff5746f69fff3e4fcfee4b5717723c4946c1d0e4a0e39262023709534784644aba5a30b7fa619990e4aca478abed8ed39ccb4b0fac26d112801f61de1cda3abd78168bc0e79d7929d7a0ac48aa86713c26203917aea92f8ea3755bdcdc95f26c8ce9c10729146ca5c4ab93cfab4f6a1c2b8c48b324966b8d6d3f998a862a396cd8d5ba2fc9b9c213c83f8d5fa2a48b93805096eceb3853e4210c81ca1b31d54a6c3f32083524d95e905c2c5e1bbb8022bac020e01e9dd16b812a340bd982dc2e442c8d816e32263b1399872e2ec838fbf86bd564aa463e52d270e8f2412a4c5f9a0003a54d5f0d6a35b73cb4b46aa78417d7e13b31ae8fcd451b5e86bb33b27fbbb0722d428964d4610b296eb4182f981f724036d2ce7852b8c90bbe146e5a0c4eb1f4371fa238ddea0a247104f5f7f7d787d9ea07319be4570f959bb8b1a0cf1d01c2402c1c2d91066829aa09af083f2e4ec2347d48e91dd4429ca97f84770afb6afbe8ef148a32be619daa2e6a648a20b3074b35370accf718ea4f85d5b9b771a7ea7a2db131fa757625a21029f3e1bbf9aaf294a3dc2a563ddf0cccdbca8c3eb70fb9b6919d7f9138c54f1429f581942dc8d3e400e399b3c9516ca4cffadb2f9e5b741085b9126af95f629a930da02c4265b9ab43123f755fe8520246b3902df0be0212a73c6f29b69ee20265aaac513c6b0fceb20f2111015ed03049ccb058e20248decf1979a83c276d9bba9bb217e584d953b970ae32535d2ed5e00b0450fd461eb529fef32a2dd66075337e6518428a0a68a06c6f8b6274237923f320b363b75e27117a32be8300e9820ced7c956e87d5bbb202f3db79f8068454eda7841c13d690d34d6603e1131da5a5c1a8007649cbca5583b52e5c37da0746aaf65e2c2bce09df6df2def5ccd17f96899bd67695cba117fa12ba7da1e8205b05e7c99ae6d52483ba784e388a8bd44a4d970d983dbddcba00d6e597fa341e5a7b12117756874c0ee22a80edb8acc45bd9d8e3e38f87313e3fb38960cb8ee28011515f3fde8b202bf4c7ff6a6ea485246eec77c6040990755d3b62db9c40387ce8dee97e967a396802a12dd27af1588b860a4b3deec3436a4dd497d74406e01a84b74806403111bf687d9b851ee124ae568d7513589655c86f5a12d66b36b3fc38d55422a05e622077fb54b140a5b56d86896a3e372688eadfab7e6d09a01cc12222c85566b7ff27e3e6ea7c893154b247021aa904e9d7c50174ef106d712f2a2c937d228782ae58d546232b23dfd5b103fa1e288bccc7e475dd8cec1713dd04651d1b1371b983a49d9d523cffd2b804dd813497a40bd7f51e55f9e30f99d4cb26e6f48dd50cfd1b93216ff34ac5ddab8338b7da077a423fafa146fc9c5e2504134e08975746d904467f7a0685f2710a4f4aa50c5e6d83598d0ee91f325db848bf9421d613777e245082de907cda3c33c242072413fcf94218b1f9e79e5773ed5cf864f0e88f5ddb6ceb005956139b23e4342b0b60934abaec95491a965d0df446e50801554668a8817de12613ffad17bf417c912489444fb0743b2f56020c61dc7facaceaab7a80bacc77bd1db1ba12e32633e8536f407f1b51c8e868f2e9f61799e20948d9a33b076377a6759e3a2de62f453bc726eea49c67adb4b7d180767b1d046ea8ea4b475cbc9a105514285e632be6a9093d8fdadf05d446360cd0b71717821e46ad3aee2a61183c3b065e874fab8b8ef98bf4d8862bacf698716fab299f8adc4ab6fa5a4c02c4e577f84e62cb2222182fd8e0fb115b4ece1683cd27350a7565058262be790b4e78ad733d05f2f75a5544c40e56fd48dffebb402f8a37fdadd0d1b6d63fe08a75915fe8c63ba675d72cb3fce92b49092b7f36783541a0b140838d3a9053f6992d1cb489a8fadc089669d21d9eddcc62cfbc95ed45f0a6e82020fbd0575e8e1ed72d5f984b2ddad0d5b2c71534f03ecdf810aace2b0846b047c4756e18dd80b8e30c4b7cb2acf063624707120802ecf85fe3b0cc31e836f953beea6248968d2f62b80f730a8903710993fdd3ec0c9ad39663d51303a15cf8e8cdcd063732a0e3e1ebbf7f6b1791768bb68131f8eb59f3cb2146bc578c0c8656eda001531e1ccf2dd88053de0623b2080c5449c21edc1cfd655595d2c7c5114366d0012d75a1ab11d438d9c3ec65811e161e982c9e1f29e21f6db1d46f3eb9d737801dc82f27b9b92d415baa3b710d71ee26ecaed28b56fdd0f5fa2151fced422bea17822e486f684912678793c244c9c41945ef49de13a5b41b6ed277b869abe2f44bb40ec2d07e23a4b4ace58cf06a580f29df4531a8ae1240b6de60b542f2e21fc4de0968fb9b1f2616b303768841495acaac5db2a53156a4c60a4b52f9ba577e66878f1c3d8f886d1badcb170ed506260077e0c11b9712ca7a08770f2a6f4872ffb37605b98ebaf4e630052a0f18b043ec4ebbe60d027fddf1a6da5e8b78ac0e133fb666c984be49e2d8b7044b58076ee16c42557387214c4284d72fa2d4df9c14f5545cbd0eb731a5f5822b38c9379a63df3407b181f9d050e48357ef209b5027c1a080c5ef9b2d2a9a1acd06481400893567f3621c939ebca1f69e7a05e67a6b70dc98be12fbad244719f8cf27f04bedf2baba6f872b8711059f18fe4b495f50410ba65ece350d9d33f526e04099545551fb0136fc68b968953309a03be33e459c6c399e2c36fab6d60266f884ae1ba0b6657db29a93ee73c206428d6a6ec140625c277f67d9cd30597ba85405592a9e48dd158e5008607391b496027aa82173f5e70b231e70cd92bde95492b3a6192a55070ce34b6c4dd184c4f7797c50d2b354b4ec0cfdd03576b868ea6aab3c80a49686d23253f7fb80000000000000000000000000000000000000000000000000000000000000005080c121a23272c"}]`
	expectedPath := "/zond/v1/builder/validators"

	hc := &http.Client{
		Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
			body, err := io.ReadAll(r.Body)
			defer func() {
				require.NoError(t, r.Body.Close())
			}()
			require.NoError(t, err)
			require.Equal(t, expectedBody, string(body))
			require.Equal(t, expectedPath, r.URL.Path)
			require.Equal(t, http.MethodPost, r.Method)
			return &http.Response{
				StatusCode: http.StatusOK,
				Body:       io.NopCloser(bytes.NewBuffer(nil)),
				Request:    r.Clone(ctx),
			}, nil
		}),
	}
	c := &Client{
		hc:      hc,
		baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
	}
	reg := &zond.SignedValidatorRegistrationV1{
		Message: &zond.ValidatorRegistrationV1{
			FeeRecipient: ezDecode(t, params.BeaconConfig().ZondBurnAddressHex),
			GasLimit:     23,
			Timestamp:    42,
			Pubkey:       ezDecode(t, "0xe0a586bb51db522c31abcbce14e6cbf6a5bbc7b3331cdb76378ca1b98acff048c11099c2713f229c349c430a6aa5623fab8d39ec266e0e7d81543fc2e4b905ec7fba75b9ab3aae53e18e2a018297ebe4bb2d0a22bd13b60b938461d922ec81dfe152224c51abcccd4105799ee2b70b53cf2401a3c01664c20ab368c4c3ccc764be5063488750f79480adcac444e274fb46500aeb2449d2a81e44c3528c70554a9ecd5b25b39550d469a43f5ec2afce668aa6598aa1c5618e569bdf08ec700a21950d6d2df3337ff196b6fcb53de94e7e127dbd7edf9c5df70c41c715b48cf4e5ab5d0e1bc4d9ead578150f98244ea47dba29af25b12a72054618d0341ebbae8e5c61cf6583c0151fdcf1323ee3cd65f8f739dc621f2aa77f8dfe36a7cef15162972c25a193bd306918deb8d6395367586ee6a534340c07caf6496dc393a0189cf81325499132a012a2b8a6152be3d3d010aadba896af83d9d447741a66100f72da46c9282a8a9af5bfec0d84d88882ce0a090147dbcef2f100f8744094a8e3712c26d875996f56a92fd99a39537197f0bbe58bb706061426e62406a300626f64b7dd813c756c159cea82a6cf82b9890be40284720b9aa9c6f1a3a78bfb8607b438ec3665225fe21370770cfdbbc20ef6525362d413ab23e85d5f6ef38a43b44874828137ab977dd9a145913ecffe2700a225042b766158d26288434511014928efdb857df4217430e18bd6c370c8327b4451611c66a118193f1155ffeef32d9b26b02d04cd083964f53b59b5ffd02789be6e8aeae4f615afb39e53f5cfbf3d9ec23640fea711fc6751abe9b3606959ac12aeb827a76a515f27d0e0f1e003e00a91a1d20b97ecde53202d6f9d61a1d4b0bd7d4f0622c2a90d67ba40f59a450191aa340bcc7b3b3107830ce1fb791a97930fd68c6b9ea0848c0591edb0a6302e0984d7f096ccb980803bbeaae3550d8996a001ecba956d3c2bb20eaa33094071e639983693f64809e449c29b59bc0b4f1530ec273f366db337bc64d95a9e26cc21ed0685cb2c606b994505bdd6237dfdb414df7eee7544f34cdf5f0e6ca1e5280b493446cb883413e26e06a00354bced7a5fd410fd92ffc39443d9e8f208aec8d81d958c060203bbe75db0cb2b982524b5e91135d4ef671ebe6c55c24bdb00d89b78c7d8fed674d1fac6d6d61bb671a996d3efe27a254e40967cb60c3c7ac5814ca5e5768f268c7002ba200da9200fc5498d07833c4b25a111d35f64cd26b108a897616d4324984e0833937344b904b964d5f292eeba6075987b5cc092bd40697ef9b2ea95cbc1eed5bf3f6337145351e98291853c3bf75eb1a533817cab5dc8d87abf034696e8dc9ad20089d79086b8608cb07101b62ae744beba3cc71e75701d46c35f317ecd1f3bb6d6078bd8cf25a55bbd200d7bfb5c9e3e2167a6abe8a6636ca82bdd63c3007b39d9a57b9f258ee4bb94325b20744087ba3a2bbda513ed067b003a0d6a4197bae5776cb25899911f92e3cdd779931e98cb11846dac49480af3c2fc3596825ccbb7a7dfa3e714d8fc809acc57577dd448e477bff03a907f8410f2ae12a9ab4a3d7738315c07f42e5af416560aafa035ae4d4b72d5e59a45dcd4c91000cd8cef454c7a157276cb2610d2d08a7bc90550c85e317fdb2d83ee26f49198dd035bbe39d6eedfbc91a1cffb5682f0410204c281f3cb8d702258c77214d77e92f1e5f4db2a6be18911c5f3950a3228d1850722f4ce0a5d56a8acf2e0311290e1334a2bfbf1251d6cb46f2a028aaa7be144f38fdb222e8a2d6320f98796731847b2449774c025a452c72dfbb9f05959c88ed86256f5fcea5458c3e22340d8ad3c3ff548f03346c55f74d6ab3aff1311a302bb8c5cd55b44528fd08ecab030c1e47385ed27de5819fd798ada8858462de7fd55aa7239e03079d976669e52ff22bf9ab6fa4860064dd5033ca6ae1fec5c628e5bc2b190ae5483514d841a25b04d127d9c536e32f3bada7b46cbb14b5718c88ed826a8c19d1fd43a7f7ff6860a88adf9fcf1415eb2c56e12a7dc6a73e24bd7cbcc7fa39ce7358f20736adc11842e72a5107bcbe78f56bb56fe403d51ea531d7d4f2681fd05f5326d7e5dd7e889a3380f9dfe8124d8f258d6f9ba6f0f6467e787d996da6310196a70f551e64d1a9dc51fe907227f43a1fb54a572db183edb726375a7a1096daeb8d7b069bf8886d282dabdb7e9101fadcdfb23c57be75a193cc3459401d14836d250b197e6ae0e4818b2bea75db388bf36f311eff18ac14b9f0fe1a354d8d397439fd202d61d545f430676eb16c6ecc4c3f583fa8767d65cdc4f3155af47629cf1b0b833a12391b02b1781f1c31cb6b05160241b1e02c5889db631ad2fa905d608b2831b45529dd7550d5ff91d4b7ae23533b1f6875b38be0f26f4479cb75579d8612ff2cfec981344598c76054584f6350d296c2436e2d43f184556d4e6208483e010ba8bcdf413d659fab3353bb8f53f085dfe24910f28b82ae382047383e81922f2d05b13d073b3fbb8042c9c1dd6a073109afffac32117a6b4162387949a9c2b21661eb321a340978b4c43dcb8ce264d6e30751c1e91551f4c2efec349bf0f083db63f3bbbbc83be7eb044b17a7fbfdeedbdd80e76580a5082d7534cea34620997ee593fc0c725a9cc41f192cdcb85d2021f2dafea48f14f63d01329845c0533210075ac3d1b674a5535d37c5c5acbd8fdee0ef9d3dc66b9fdec661f3ed53d1c70c825937716af2d44510d07876b3d52c063e7ddca41faee15d3b81940dd50d41ad5791b4b37f44cecc11db9ce58c7555491ee822e8ff1d8b0dac3eb409f8b827561ea6b7d88af82892a53ff2d239c76a8a1a717b101c7b9d7db85a84a508276b8d1ba972d31089cce5dba3ed722ead0849d336b1002f41f1b1b93d2a7e56e5c222d21327d872534aae80e8f7020c4fda6fd4765bd94df4aa38c51924b356412ae0ceff6adfdad9b9c793ee6aec73a902f658ffd6af25abf374368e38a8b9e91b34d2eeca566eb39ffa67978077870b21279afc7760f38639ad6fa152af670f25de919fcecc16755bafff466a0b8d9910bf84bc5917a33ed76fd62c47a9a2ca68055668a13f11616b7f95cda26c2b09bbe8c83609af99ec41470bda5b12524a849950caf6fb96d908dabca97187858c83a54cb2dee7fcabbc0fea8d3ca1b860d1d7b5eb1dc2a687330d2fb237f55d97fbab4694e4037355548f1c20122da77eb0b7b90205989bb9ef52f76f88770eabf56f5d9ccaf572b3eadb7c9810e93b675e7e9ea26f8d8749fcb23c63993d62406db2a53996dc053e698e70360492e2c467e1baf2d76a9dc74f23c3be3d27685c5fd07a30d2aab3f2cd7fde563e29a3434ee6a51f795a5e114a3d6259732362126da789d82ee54dae91c3e2c060a4f79943068cb6a3ee5692587a67816aa5a9c5ff3805173c72a5ad2b0ebd8588253bae50da117d938901f8ffbf725ced16a76f9f53d782ebe1f0d6f6dfdaa4fe8f93ec6246b66e561c740fc7eaf6c771659e90f545b9e89221fc9450543424f0a14ad7484253251f658e56cf1cb161b4cee63c6c5b96cf8c06e6aa524c8209205de7fdbf1e233135755ed6300ed4c096764fe4dd4855f421d272cd63150db47bc6f47bf624798"),
		},
		Signature: ezDecode(t, "0x23b7f3eb8de34c192a57e259a4857a62a1f5308f949fb0de8a6ae80934bc925137900f1f7f58feb511fb6b9800916b6c7042cf054ff6399362190d9e2be45586a72ab04818ad69e14b5f6428df64482b92f6a4e83af0f22a4f5e85db875a3c9c4ffe4372b4950d40d88a12779656c9454eaa01d6142ab9fbd8adb8f4ec7faa88152d4c40e849bbac1241f128d7c4d46907f0bbbc417a8bc6255cd10d306a42c022242f9a6ea5241a11d511a78872431d3dbab7275830c8fcc30abaccee67aad87ed1e97a7c611ff17213b4ef4c720198adbc39345808835519a473dbaddfc709369570309141eff0690b130074a81634b054c1cb3e9da3bc0489bd4299bb553021d42537ccf8bd09d5f36dcdbd1ef956d1c35534e9252c737cdb98ad4f70b52651c450d20583f697005d881247cc2927f36027fcc10f7fa841496502d4137b110dccc303eaabce693a0471b1ffe369a4dd4fe718721fd47a1c35a59d230a54b09becec6d6582b5d617aded2955ad786a24072a5ff54e70ca885a923283fe64cf0305034c0dc52d92cee1e9333c5a38e1ae5af60ab3f9e801ace98ab069b0fbc18600aaf121cf4bd74af25c001a452c2b562205a45e9fd71346d1bf8b7f56ff6d0a3acb4101b3c625c5d57d576a3c68c0db381b46acaa0adbf0b3df9f2e82ca346361fbed145d46012daaaeec0d6605351f1d3fadf8881d2b1d0503a55a9b6d62e013f9d6c3b2d6c69b2ea7832795374eee680a3938b671b1672be12bccab41bb3b236c11323d3e0846eda85dc8d012f0ac4ce7c9e8df4eb92ae996d4829a139aa56b26c263d5cb6de5a174cbdff23c98a7880c89d199e56148cacc03e6d37b856cf470573d071f5049f7f5641e9f01da2bc3e8b97afcd5fabf8791e729bc37b0f0f0f832c790b4ac88ce30e72f22ecd2a2d99b4d499c1d3991014d976e111586d4c141a32fa4e79a17cf3697636c59ece30858644a64aa7ff91cec132de6196b16c1d581ac23fe059ebfdd012f2a5f5e2177c914140c19f4ba90d744ee01b39ac74494e0d80efcd9ff068ddf576c3e1125daf5b7da6a3de542983c02f74d584354881dda25d97662b6e494d7dd30fcd3a8583bcde25080ba2f599784923bd7e322fc582bd36a6ca8efd18f4b0d85e526b96558395c72b3893874925617c88b5bed1f159f2b779c10f1e020ecdcfe483a58f084fdae8b6f87a9b7bd3cedaec2915693612e8e6a20666d814b01748b708b529a6392ead7b9568ea5188eddc848ac40d7231abac559b841022a8fde966290a6a233fe77cdb05ee46967004e6993ef666ad07da213e2767cb132a2c4d544308d95f02b86abaf1db3dfae541eb2a4d163a18f123807bb4d8ce674f58eabebe21e8c155d7a8f883136af2567d77e35ea248a4eefc574089ac0aae4c69d36485ae6afbef2235f383efbfa7c8eae6aa0cb0dec23fea98c74dbbe69fd04ca2ed4a8c3207b178abf39b217361c6c981af38eda178017ccedfb6c42b3b5f52645aa7399197c8c4cef8662af996b1483b03fc0a8d128bca221e9ca5c93a9c4de167c91e8342d340fca343ee5bae69115a914757c077957e5052256e894e481177834d084a645c7fa4c7d885bc8e33d7b7be9953fe6a8a98b6d7943579b3dbf23c3d4594c93b951a7f27b112a33264844df1e0600857b30e5863cc3107a642988ca210db0ec09adc554945d1dc3dda6b9ce7aa7747ed39f3eff0ebd63153f807a017d5ee1b5b5358f8434ce7c8a65df9517aae2a4582d15e86cc6f14cee3b6fceb9466c76f6c8ef9af0cc9fde8c4205bf8804d4a5d916b8ab75c9a3004977d7690b870a8f7292c8c515c56b4887c4431eabda1ea7a3f93acaa32afa5d0a416c2411f1723e544c8e76f470e4a4099f766428b54b68001031fdcd1b2d18bfa72c1b72ff83a44b8ab697d289ebadeea0a5cf0c308a6f8087635ed7df1cd6cf2057e5471f73561f8b6e888388f128766bebc9804a527be652f804e4c176f89d540b70359c2240ef3ddd2969765fb00014996ada33057d4ab844cf4d5b1f1c9cfd51c94583f23bbe5ce1f467b11fff9ba4b3f64cbf76825be4010cb7567072836526324fc7602a713f92051bd15cbfb6f2a01bd3d257e77d08724ddc708ea10c13922df5edf96963eebdbcdefc06118e6fb04cde68f11dfbb69a93aa3889b9fb6cca907f085a52bae555f721c315dea80028f8016d5e203f1b266c224a5608617e1bec9eb3e19338b8e970863d77432bc8aad37052a6f8c14f5efa387d24b4785a9db270e97a500f7d67262111363932778e823ba10f5c723d427d0f917222a8777f2d4af05e9668fd54e70e0dcecaf10f07d81a5860efc5bea3a3f398c7bb4558db6833270e618e8350a3b6a43a7a45e3d13d3f577b06784f535608d804b237b322e020911cde3f5841e672e5ef16cab309eaef0bca69b000297081f3b83dd29c2bb5ec5c673d6fd022a7ae2aa58c609f64cda3dde7d9e810c0e3c151684570abd1246cfd2cc4aedeea932c668629b471dcda1678b60f932213b67982e1000bcd830396886fccda9f01fa33c7c582a1083023386a9d71a7c7767ad9086adcf10c86263e1477a13b32902334af59115a422e064158f9ced4a536848762c3b99780aeb14b780938822dd9c08cf8a8df9accd7796a9266a26d1bfe098fce386b933a5a9f50d1fa61ff4f778e772cf9db7fcce913ae76342ab189d3f0a5a3b9f41c3d6a0128fecc156b97a3459c2249359e5e6387066dd2095ca2836768be8b7e7525a855d28e56481bdb808910ea9a6db004ebcd959e3ab2c60d174f3448933038860c126c7121f04220804bf7f816c5ccac37acd86c5252c657d29eac45ec8c0e64da58d6c9e430a8c0f8578e98d29dd45a7e6ce2b6469a086b7dfceb550547ddcacc0b3a5be5491b4827aa6ef9aca1386b51b2be96a05751bc69154312a21f60069f530195bc5018c14c03fe47e749bf1f476dbfd63235aeab1606526c63e3977f03df6b601a0f8ef6952192ff29801011ce3f809f885b0f46700246c1b53095d8ad98de20c62687fa06f391da2d28e387f61115d332230dd5afc12b28479b8223f519f3042f96a6c49255b2ce74f2d4634c32bb67d10dedd56aebdb1e54bf144e4a429f10950c2b1388f3bec123ddfe112f69c785264a09352c9f3ee436dac1e2ce5e3413e14e47ab1cd178a68b97f99fe933a353e7c8b669296d1ba50426878ffc3a1d616a91964cd92917731108863a70699b11cba6b4c2534edaf3d7482e3e5e6227c4291fe34cb8ce3b4bdb62e37d0a9ccae2fa01c23593b9985b3c2c5eb38b0be17850f244f9f8c57687fdce2f9ce79a371662e75bea4947732c958e30d84f0ce6ed6f4829bbe83e62121ecd3307ed15c73fd45cc3a06d632e34aae6f97e9255d9cde21ebc6dd57595b518544007bf32014aa5cb12cf667ff6f2caf8f9aac790640a9c509afab7ee5335f8421efc9fcf408bf70c270081ebe09b29ab9089eaba87ba409376a887fae7136c79772e961dcd45f8d4df1895d5bf109ecbea093c502ec0a80ff5746f69fff3e4fcfee4b5717723c4946c1d0e4a0e39262023709534784644aba5a30b7fa619990e4aca478abed8ed39ccb4b0fac26d112801f61de1cda3abd78168bc0e79d7929d7a0ac48aa86713c26203917aea92f8ea3755bdcdc95f26c8ce9c10729146ca5c4ab93cfab4f6a1c2b8c48b324966b8d6d3f998a862a396cd8d5ba2fc9b9c213c83f8d5fa2a48b93805096eceb3853e4210c81ca1b31d54a6c3f32083524d95e905c2c5e1bbb8022bac020e01e9dd16b812a340bd982dc2e442c8d816e32263b1399872e2ec838fbf86bd564aa463e52d270e8f2412a4c5f9a0003a54d5f0d6a35b73cb4b46aa78417d7e13b31ae8fcd451b5e86bb33b27fbbb0722d428964d4610b296eb4182f981f724036d2ce7852b8c90bbe146e5a0c4eb1f4371fa238ddea0a247104f5f7f7d787d9ea07319be4570f959bb8b1a0cf1d01c2402c1c2d91066829aa09af083f2e4ec2347d48e91dd4429ca97f84770afb6afbe8ef148a32be619daa2e6a648a20b3074b35370accf718ea4f85d5b9b771a7ea7a2db131fa757625a21029f3e1bbf9aaf294a3dc2a563ddf0cccdbca8c3eb70fb9b6919d7f9138c54f1429f581942dc8d3e400e399b3c9516ca4cffadb2f9e5b741085b9126af95f629a930da02c4265b9ab43123f755fe8520246b3902df0be0212a73c6f29b69ee20265aaac513c6b0fceb20f2111015ed03049ccb058e20248decf1979a83c276d9bba9bb217e584d953b970ae32535d2ed5e00b0450fd461eb529fef32a2dd66075337e6518428a0a68a06c6f8b6274237923f320b363b75e27117a32be8300e9820ced7c956e87d5bbb202f3db79f8068454eda7841c13d690d34d6603e1131da5a5c1a8007649cbca5583b52e5c37da0746aaf65e2c2bce09df6df2def5ccd17f96899bd67695cba117fa12ba7da1e8205b05e7c99ae6d52483ba784e388a8bd44a4d970d983dbddcba00d6e597fa341e5a7b12117756874c0ee22a80edb8acc45bd9d8e3e38f87313e3fb38960cb8ee28011515f3fde8b202bf4c7ff6a6ea485246eec77c6040990755d3b62db9c40387ce8dee97e967a396802a12dd27af1588b860a4b3deec3436a4dd497d74406e01a84b74806403111bf687d9b851ee124ae568d7513589655c86f5a12d66b36b3fc38d55422a05e622077fb54b140a5b56d86896a3e372688eadfab7e6d09a01cc12222c85566b7ff27e3e6ea7c893154b247021aa904e9d7c50174ef106d712f2a2c937d228782ae58d546232b23dfd5b103fa1e288bccc7e475dd8cec1713dd04651d1b1371b983a49d9d523cffd2b804dd813497a40bd7f51e55f9e30f99d4cb26e6f48dd50cfd1b93216ff34ac5ddab8338b7da077a423fafa146fc9c5e2504134e08975746d904467f7a0685f2710a4f4aa50c5e6d83598d0ee91f325db848bf9421d613777e245082de907cda3c33c242072413fcf94218b1f9e79e5773ed5cf864f0e88f5ddb6ceb005956139b23e4342b0b60934abaec95491a965d0df446e50801554668a8817de12613ffad17bf417c912489444fb0743b2f56020c61dc7facaceaab7a80bacc77bd1db1ba12e32633e8536f407f1b51c8e868f2e9f61799e20948d9a33b076377a6759e3a2de62f453bc726eea49c67adb4b7d180767b1d046ea8ea4b475cbc9a105514285e632be6a9093d8fdadf05d446360cd0b71717821e46ad3aee2a61183c3b065e874fab8b8ef98bf4d8862bacf698716fab299f8adc4ab6fa5a4c02c4e577f84e62cb2222182fd8e0fb115b4ece1683cd27350a7565058262be790b4e78ad733d05f2f75a5544c40e56fd48dffebb402f8a37fdadd0d1b6d63fe08a75915fe8c63ba675d72cb3fce92b49092b7f36783541a0b140838d3a9053f6992d1cb489a8fadc089669d21d9eddcc62cfbc95ed45f0a6e82020fbd0575e8e1ed72d5f984b2ddad0d5b2c71534f03ecdf810aace2b0846b047c4756e18dd80b8e30c4b7cb2acf063624707120802ecf85fe3b0cc31e836f953beea6248968d2f62b80f730a8903710993fdd3ec0c9ad39663d51303a15cf8e8cdcd063732a0e3e1ebbf7f6b1791768bb68131f8eb59f3cb2146bc578c0c8656eda001531e1ccf2dd88053de0623b2080c5449c21edc1cfd655595d2c7c5114366d0012d75a1ab11d438d9c3ec65811e161e982c9e1f29e21f6db1d46f3eb9d737801dc82f27b9b92d415baa3b710d71ee26ecaed28b56fdd0f5fa2151fced422bea17822e486f684912678793c244c9c41945ef49de13a5b41b6ed277b869abe2f44bb40ec2d07e23a4b4ace58cf06a580f29df4531a8ae1240b6de60b542f2e21fc4de0968fb9b1f2616b303768841495acaac5db2a53156a4c60a4b52f9ba577e66878f1c3d8f886d1badcb170ed506260077e0c11b9712ca7a08770f2a6f4872ffb37605b98ebaf4e630052a0f18b043ec4ebbe60d027fddf1a6da5e8b78ac0e133fb666c984be49e2d8b7044b58076ee16c42557387214c4284d72fa2d4df9c14f5545cbd0eb731a5f5822b38c9379a63df3407b181f9d050e48357ef209b5027c1a080c5ef9b2d2a9a1acd06481400893567f3621c939ebca1f69e7a05e67a6b70dc98be12fbad244719f8cf27f04bedf2baba6f872b8711059f18fe4b495f50410ba65ece350d9d33f526e04099545551fb0136fc68b968953309a03be33e459c6c399e2c36fab6d60266f884ae1ba0b6657db29a93ee73c206428d6a6ec140625c277f67d9cd30597ba85405592a9e48dd158e5008607391b496027aa82173f5e70b231e70cd92bde95492b3a6192a55070ce34b6c4dd184c4f7797c50d2b354b4ec0cfdd03576b868ea6aab3c80a49686d23253f7fb80000000000000000000000000000000000000000000000000000000000000005080c121a23272c"),
	}
	require.NoError(t, c.RegisterValidator(ctx, []*zond.SignedValidatorRegistrationV1{reg}))
}

func TestClient_GetHeader(t *testing.T) {
	ctx := context.Background()
	expectedPath := "/zond/v1/builder/header/23/0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2/0x94ef47878aea6c24a6aac5d43465cc361bbaf8bc8c9eba9abccda48977767f5604b8150337fd5ca7cf90bf8f63fca0e6fc0728a3071e5ccae2766a15679d2a57ddc95f6f51ff8bb831aaa937271eb80d599566ae1e73173aad708f68330bbd9c6555c0f9366763011f7aa4edebab101f99a4007c8ae1123a13e7c7cc19e2e7699b549bb770d3753bea49ec9e31104bae89fc38abe75e1f140267a2f492409d25f188aec4783afd2c8140f6a8c6850077536cb2760c65779d165b6f03f9b149210d8160f58803d31171be717baf887aa612c02f806bd9e3332ddc21c0e6e912d053d4d49c13d2de8a75266e6157610175d4897e58886aae12bf7b949e20351d80a4a994e7c70c9ba76a2472818343609061ffa393f6f270dc8b4aa806d5616e55e936f26cccd3e1006bf185196ae5457d224fca6555068bfb64a228e8b44b4221e85d2f1137224992f41a78301ff768527e953e50424a45d21e8877a16a915629f45aba1aca08769c561260d4d58bcf36af98c26e6b81365b91720f3155c1f9383d8c7ab295aabe6c9799f625d29da42bd4002fbd337ceaf991573678f6384da18541c4e3a3c9472620c19129bb41e2b5e71884b98a8ac319a0ec2be11948f4c02b0b824a2347e00945ec89f45f431dfb3605d8228ce69136867570bd0149f4fe2b53f19d1458e7d6f9688af7c5ec3021fbe61cb331a5a44c9f5e9a4a1192d5eeddf98f47e1c8379bf000ae6886cc3eb5442fa8586652550876a4ef31dd941eac082e9fb1ff26db706159ec7be0a5051b408fc955c55335db1f46c6e87113aabb03960f2f4fc986e4e583021b6b69e7c68b0d1093429630cf7f4a7e895ad45a41363c53d0ddce0804a8858092bc7a069852fff02773e0abd6c7cc7d3d34c0bebfb34e1c5e95ddb184c4a0fc77ed09fca96dc472ba0391214c489890ea410085d4c6ecc69f3facf0b1587372752a421641597563fedc9fc64452d7a7a0db9560ec1c8564a3180a5e623b65e1dd494f967556bde56f9bf58cf5e07a050258e4a90cc2700831a4113391877c65ebaadea8710e23ca9f7afb8c5bd90edf38211b32874b65bef5455159c1a1d17ac3da17819f8adcb254a62d7f4c362cc470f75fddaf6f6624f3a56b0187c4e21295534a832a0f2720c411d0685751fff095078d18bc854856f7e1abe14eb76e9e45fd1eca282804784d9c27fd15ab00bb6dbfd864c401f759d0f2da8ad8640b81066038b72c6cf26605f8388cdd67aeca21dda79d6dd01bc3d3ff5ee29f5e016ea681ba581940d0130685d42e9635c6ca27e1eb9fbf08f44879f4f479eefbde7b65476fbe379f771b0f116a2e6e5f65416b72f2c49452c40b2f108ab86ac7dbb8e252ed32946e5be280b512734c96db9511b21eeec3d0caeac51f8ca315ad7dd62efd1113e03932856d5eef73035a0ae24fef22a2c8aa1db28bc87702c34b2d2d722ddf0ad9d2eb4a6c16b85a7e22c49d115c676afeef8f66ec95ec805e4c1423df5dc2eeece55f107005e15b3ded7c5ff7b7d6fd8530049ede7b776bee594fc18e29a4ae177419bfcb2a0185f51ab35c389baf9b37742192e1c36c2ba7d5c46f683dfa8ca8103a824033c68d844d0ed55e560b96b8421162f57e2daaef5853bfe476903fcb42196e78ae2afe3d5da230de9628e2d268dfc50290b2a8ddae0ade58e2919e0f9be4b538220b885e20b28741cce7c6072aa27cf076197d8e046072045f4a4e20058e7ff428419ce7629b7f76dc0568d99586fc4095107b02228d4f2e9978abe68ef302747a67805d0158b88e94bdb73f1c6e1ca8918b311b0a5d101130e142d2085778d1546532c842f2673cb7a3774eb6d23fa901883aaa682aa7ed0195c3f899f6b485e09715a3791ac9102c177b37465344523fef3e9479ce39d358db0106b5b4cfe26415c5ebc2d00ab36af1171ca33f2c95ff16b63f91e10de4405aec7d6368afc20643616bf30505507f7af84a6f70a36c9f6644bf22bb141f88f15c01f99fbb0344b6db03c042cb8e80e6e38717c3e749cae3782b3d3529cbcfd68a04ade376a7f334ea471d21ebbc62035a57cced3f74a1612edb492a13aacc93d51348249451616f01bbd0e89f46fa53acc5490c7164ef8b2ac0a236b9da37f696db7d2e2dd51243966d2deeae418f2edc6f38fabe746ec5bc832db5af6856266c140e78ce15c2699778910c8e002290b52a68bd14c3be294154c7f448be0160d4adc856b307aa4d3a3ec82af0d25d951d25dc2027ed7861c9ef7d0228179a9fd38ba45f8721d6ce3dd42dce8f58f917d3555c04151cae3e0fc761291c632c0f13e618958cda614f7650efd18e1ffed06bc171530b5bde901becb2b021db47e541679bbb55f7337e1d205e1031eb2ef9a332e84bcbd9b5e27682159c86d3031ab01d741fedf1b05a4e1bc82da108855c8d833abb99821c8be81df68818e2aa094a3cde6f3d5e1bd8b2e86daba12aa2b572ffc81c65c3e498432edb00f1fe6fb04ec92a96b2c206a36a5623f8710c06cc20fdc661230f8b441ce4ebfa45a2890a4a43f2dbd498a9ef9d1f4e748ec81bca42a27aa8acd72406ca303050a32aa644f60e1c58a036ca2b0f0ca69092f6d08a40ee97ff700931b87039bdff71043a75b1578b33d98b391ae0dccbd46f5428cc80016412cbce9532b70454ab801c77072249412a2d49e8f608ab7480b1a9416714c825bd07a96641b865daeda71a5bf6b9e28bbf4a9042e79a6d6dd0c1d99dd3cabf4d580b6bc22999acbfb6f25a33e622104c13aa173e2191eb70dd0db82ae47d1ddbbdb24d3d4403bcaa64bcde88c86ce5bd535694b24f117e729abb3582e2166658f969a206b44aa37837c6efd7f094443c65f43b95826aa97ab1d3dc9aa3e56b31b1d2fe5e2eb44d2b5ccb1039118ac3917148fe4dffdc81daac74007ce71dd5e779be416de62b271bc4379e0a24c6c42e8e8c0213dee8588752d54b12b4da7be2e7a75c6b3e8ad9a92a4768d0611bc91ddd4aebda0cfb84226280ce6f621b5a83016b51bc9de2fe0413ce43ff967cf3680c9e1c359316ab207d93382df330b6a1fff25f01506952465fbdc1d36aeb0124b593b29619b712867c63c7e872d65d18b8834c505ff23688bda7b9d4e4969d6b69aae0b5ff14a152191c5f94a061aa3a7db71bc4ad9ce217a931a92b35e6faec8e00800f96b0efe6d42d1edf25573f12da245539f8fba9ab270cf738d585a144d9098e5d529f3e8662903de413ca9174b9bc6da0a70be23cce8b1dd7b0a1db109605f20d3ba5d72d4361e63cdbfe58ba1e19c0cbb0ab65090c8dc30265ac76a191707804756107d14e1ec41b6b8765286f99960fb601394bb1db089bd5ea19f3b98666e003affb6e9477a42f1c836efdb2355ce392849a777a6c4ac9e1eeb7bad57faa0f25eec2adf2d2d3b20e5ad1ce82ffdd9264e90a37a269f24841742479ccfadb38664c503191da287b16ca59d06b0ebb09e658cc0090665d8ca90b917c4a089b9474b9d76ba7d9deeb96f9a82ed10365d756da05f23bc9f81222b09e5d4b490977052f0bdd3afacd28b2f6730b3a6784eff8653fc8dcca5d17f7c34b05a30cf939ca10c52b714a5ab51b77b523917963a9f3374c7004b81588e06103615fb793dc267e8e3677d8fed75cb371"
	var slot types.Slot = 23
	parentHash := ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2")
	pubkey := ezDecode(t, "0x94ef47878aea6c24a6aac5d43465cc361bbaf8bc8c9eba9abccda48977767f5604b8150337fd5ca7cf90bf8f63fca0e6fc0728a3071e5ccae2766a15679d2a57ddc95f6f51ff8bb831aaa937271eb80d599566ae1e73173aad708f68330bbd9c6555c0f9366763011f7aa4edebab101f99a4007c8ae1123a13e7c7cc19e2e7699b549bb770d3753bea49ec9e31104bae89fc38abe75e1f140267a2f492409d25f188aec4783afd2c8140f6a8c6850077536cb2760c65779d165b6f03f9b149210d8160f58803d31171be717baf887aa612c02f806bd9e3332ddc21c0e6e912d053d4d49c13d2de8a75266e6157610175d4897e58886aae12bf7b949e20351d80a4a994e7c70c9ba76a2472818343609061ffa393f6f270dc8b4aa806d5616e55e936f26cccd3e1006bf185196ae5457d224fca6555068bfb64a228e8b44b4221e85d2f1137224992f41a78301ff768527e953e50424a45d21e8877a16a915629f45aba1aca08769c561260d4d58bcf36af98c26e6b81365b91720f3155c1f9383d8c7ab295aabe6c9799f625d29da42bd4002fbd337ceaf991573678f6384da18541c4e3a3c9472620c19129bb41e2b5e71884b98a8ac319a0ec2be11948f4c02b0b824a2347e00945ec89f45f431dfb3605d8228ce69136867570bd0149f4fe2b53f19d1458e7d6f9688af7c5ec3021fbe61cb331a5a44c9f5e9a4a1192d5eeddf98f47e1c8379bf000ae6886cc3eb5442fa8586652550876a4ef31dd941eac082e9fb1ff26db706159ec7be0a5051b408fc955c55335db1f46c6e87113aabb03960f2f4fc986e4e583021b6b69e7c68b0d1093429630cf7f4a7e895ad45a41363c53d0ddce0804a8858092bc7a069852fff02773e0abd6c7cc7d3d34c0bebfb34e1c5e95ddb184c4a0fc77ed09fca96dc472ba0391214c489890ea410085d4c6ecc69f3facf0b1587372752a421641597563fedc9fc64452d7a7a0db9560ec1c8564a3180a5e623b65e1dd494f967556bde56f9bf58cf5e07a050258e4a90cc2700831a4113391877c65ebaadea8710e23ca9f7afb8c5bd90edf38211b32874b65bef5455159c1a1d17ac3da17819f8adcb254a62d7f4c362cc470f75fddaf6f6624f3a56b0187c4e21295534a832a0f2720c411d0685751fff095078d18bc854856f7e1abe14eb76e9e45fd1eca282804784d9c27fd15ab00bb6dbfd864c401f759d0f2da8ad8640b81066038b72c6cf26605f8388cdd67aeca21dda79d6dd01bc3d3ff5ee29f5e016ea681ba581940d0130685d42e9635c6ca27e1eb9fbf08f44879f4f479eefbde7b65476fbe379f771b0f116a2e6e5f65416b72f2c49452c40b2f108ab86ac7dbb8e252ed32946e5be280b512734c96db9511b21eeec3d0caeac51f8ca315ad7dd62efd1113e03932856d5eef73035a0ae24fef22a2c8aa1db28bc87702c34b2d2d722ddf0ad9d2eb4a6c16b85a7e22c49d115c676afeef8f66ec95ec805e4c1423df5dc2eeece55f107005e15b3ded7c5ff7b7d6fd8530049ede7b776bee594fc18e29a4ae177419bfcb2a0185f51ab35c389baf9b37742192e1c36c2ba7d5c46f683dfa8ca8103a824033c68d844d0ed55e560b96b8421162f57e2daaef5853bfe476903fcb42196e78ae2afe3d5da230de9628e2d268dfc50290b2a8ddae0ade58e2919e0f9be4b538220b885e20b28741cce7c6072aa27cf076197d8e046072045f4a4e20058e7ff428419ce7629b7f76dc0568d99586fc4095107b02228d4f2e9978abe68ef302747a67805d0158b88e94bdb73f1c6e1ca8918b311b0a5d101130e142d2085778d1546532c842f2673cb7a3774eb6d23fa901883aaa682aa7ed0195c3f899f6b485e09715a3791ac9102c177b37465344523fef3e9479ce39d358db0106b5b4cfe26415c5ebc2d00ab36af1171ca33f2c95ff16b63f91e10de4405aec7d6368afc20643616bf30505507f7af84a6f70a36c9f6644bf22bb141f88f15c01f99fbb0344b6db03c042cb8e80e6e38717c3e749cae3782b3d3529cbcfd68a04ade376a7f334ea471d21ebbc62035a57cced3f74a1612edb492a13aacc93d51348249451616f01bbd0e89f46fa53acc5490c7164ef8b2ac0a236b9da37f696db7d2e2dd51243966d2deeae418f2edc6f38fabe746ec5bc832db5af6856266c140e78ce15c2699778910c8e002290b52a68bd14c3be294154c7f448be0160d4adc856b307aa4d3a3ec82af0d25d951d25dc2027ed7861c9ef7d0228179a9fd38ba45f8721d6ce3dd42dce8f58f917d3555c04151cae3e0fc761291c632c0f13e618958cda614f7650efd18e1ffed06bc171530b5bde901becb2b021db47e541679bbb55f7337e1d205e1031eb2ef9a332e84bcbd9b5e27682159c86d3031ab01d741fedf1b05a4e1bc82da108855c8d833abb99821c8be81df68818e2aa094a3cde6f3d5e1bd8b2e86daba12aa2b572ffc81c65c3e498432edb00f1fe6fb04ec92a96b2c206a36a5623f8710c06cc20fdc661230f8b441ce4ebfa45a2890a4a43f2dbd498a9ef9d1f4e748ec81bca42a27aa8acd72406ca303050a32aa644f60e1c58a036ca2b0f0ca69092f6d08a40ee97ff700931b87039bdff71043a75b1578b33d98b391ae0dccbd46f5428cc80016412cbce9532b70454ab801c77072249412a2d49e8f608ab7480b1a9416714c825bd07a96641b865daeda71a5bf6b9e28bbf4a9042e79a6d6dd0c1d99dd3cabf4d580b6bc22999acbfb6f25a33e622104c13aa173e2191eb70dd0db82ae47d1ddbbdb24d3d4403bcaa64bcde88c86ce5bd535694b24f117e729abb3582e2166658f969a206b44aa37837c6efd7f094443c65f43b95826aa97ab1d3dc9aa3e56b31b1d2fe5e2eb44d2b5ccb1039118ac3917148fe4dffdc81daac74007ce71dd5e779be416de62b271bc4379e0a24c6c42e8e8c0213dee8588752d54b12b4da7be2e7a75c6b3e8ad9a92a4768d0611bc91ddd4aebda0cfb84226280ce6f621b5a83016b51bc9de2fe0413ce43ff967cf3680c9e1c359316ab207d93382df330b6a1fff25f01506952465fbdc1d36aeb0124b593b29619b712867c63c7e872d65d18b8834c505ff23688bda7b9d4e4969d6b69aae0b5ff14a152191c5f94a061aa3a7db71bc4ad9ce217a931a92b35e6faec8e00800f96b0efe6d42d1edf25573f12da245539f8fba9ab270cf738d585a144d9098e5d529f3e8662903de413ca9174b9bc6da0a70be23cce8b1dd7b0a1db109605f20d3ba5d72d4361e63cdbfe58ba1e19c0cbb0ab65090c8dc30265ac76a191707804756107d14e1ec41b6b8765286f99960fb601394bb1db089bd5ea19f3b98666e003affb6e9477a42f1c836efdb2355ce392849a777a6c4ac9e1eeb7bad57faa0f25eec2adf2d2d3b20e5ad1ce82ffdd9264e90a37a269f24841742479ccfadb38664c503191da287b16ca59d06b0ebb09e658cc0090665d8ca90b917c4a089b9474b9d76ba7d9deeb96f9a82ed10365d756da05f23bc9f81222b09e5d4b490977052f0bdd3afacd28b2f6730b3a6784eff8653fc8dcca5d17f7c34b05a30cf939ca10c52b714a5ab51b77b523917963a9f3374c7004b81588e06103615fb793dc267e8e3677d8fed75cb371")

	t.Run("server error", func(t *testing.T) {
		hc := &http.Client{
			Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
				require.Equal(t, expectedPath, r.URL.Path)
				message := ErrorMessage{
					Code:    500,
					Message: "Internal server error",
				}
				resp, err := json.Marshal(message)
				require.NoError(t, err)
				return &http.Response{
					StatusCode: http.StatusInternalServerError,
					Body:       io.NopCloser(bytes.NewBuffer(resp)),
					Request:    r.Clone(ctx),
				}, nil
			}),
		}
		c := &Client{
			hc:      hc,
			baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
		}

		_, err := c.GetHeader(ctx, slot, bytesutil.ToBytes32(parentHash), bytesutil.ToBytes2592(pubkey))
		require.ErrorIs(t, err, ErrNotOK)
	})
	t.Run("header not available", func(t *testing.T) {
		hc := &http.Client{
			Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
				require.Equal(t, expectedPath, r.URL.Path)
				return &http.Response{
					StatusCode: http.StatusNoContent,
					Body:       io.NopCloser(bytes.NewBuffer([]byte("No header is available."))),
					Request:    r.Clone(ctx),
				}, nil
			}),
		}
		c := &Client{
			hc:      hc,
			baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
		}
		_, err := c.GetHeader(ctx, slot, bytesutil.ToBytes32(parentHash), bytesutil.ToBytes2592(pubkey))
		require.ErrorIs(t, err, ErrNoContent)
	})

	t.Run("capella", func(t *testing.T) {
		hc := &http.Client{
			Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
				require.Equal(t, expectedPath, r.URL.Path)
				return &http.Response{
					StatusCode: http.StatusOK,
					Body:       io.NopCloser(bytes.NewBufferString(testExampleHeaderResponse)),
					Request:    r.Clone(ctx),
				}, nil
			}),
		}
		c := &Client{
			hc:      hc,
			baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
		}
		h, err := c.GetHeader(ctx, slot, bytesutil.ToBytes32(parentHash), bytesutil.ToBytes2592(pubkey))
		require.NoError(t, err)
		expectedWithdrawalsRoot := ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2")
		bid, err := h.Message()
		require.NoError(t, err)
		bidHeader, err := bid.Header()
		require.NoError(t, err)
		withdrawalsRoot, err := bidHeader.WithdrawalsRoot()
		require.NoError(t, err)
		require.Equal(t, true, bytes.Equal(expectedWithdrawalsRoot, withdrawalsRoot))
		value, err := stringToUint256("652312848583266388373324160190187140051835877600158453279131187530910662656")
		require.NoError(t, err)
		require.Equal(t, fmt.Sprintf("%#x", value.SSZBytes()), fmt.Sprintf("%#x", bid.Value()))
		bidValue := bytesutil.ReverseByteOrder(bid.Value())
		require.DeepEqual(t, bidValue, value.Bytes())
		require.DeepEqual(t, big.NewInt(0).SetBytes(bidValue), value.Int)
	})
	t.Run("unsupported version", func(t *testing.T) {
		hc := &http.Client{
			Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
				require.Equal(t, expectedPath, r.URL.Path)
				return &http.Response{
					StatusCode: http.StatusOK,
					Body:       io.NopCloser(bytes.NewBufferString(testExampleHeaderResponseUnknownVersion)),
					Request:    r.Clone(ctx),
				}, nil
			}),
		}
		c := &Client{
			hc:      hc,
			baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
		}
		_, err := c.GetHeader(ctx, slot, bytesutil.ToBytes32(parentHash), bytesutil.ToBytes2592(pubkey))
		require.ErrorContains(t, "unsupported header version", err)
	})
}

func TestSubmitBlindedBlock(t *testing.T) {
	ctx := context.Background()

	t.Run("capella", func(t *testing.T) {
		hc := &http.Client{
			Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
				require.Equal(t, postBlindedBeaconBlockPath, r.URL.Path)
				require.Equal(t, "capella", r.Header.Get("Zond-Consensus-Version"))
				return &http.Response{
					StatusCode: http.StatusOK,
					Body:       io.NopCloser(bytes.NewBufferString(testExampleExecutionPayload)),
					Request:    r.Clone(ctx),
				}, nil
			}),
		}
		c := &Client{
			hc:      hc,
			baseURL: &url.URL{Host: "localhost:3500", Scheme: "http"},
		}
		sbb, err := blocks.NewSignedBeaconBlock(testSignedBlindedBeaconBlockCapella(t))
		require.NoError(t, err)
		ep, err := c.SubmitBlindedBlock(ctx, sbb)
		require.NoError(t, err)
		withdrawals, err := ep.Withdrawals()
		require.NoError(t, err)
		require.Equal(t, 1, len(withdrawals))
		assert.Equal(t, uint64(1), withdrawals[0].Index)
		assert.Equal(t, types.ValidatorIndex(1), withdrawals[0].ValidatorIndex)
		assert.DeepEqual(t, ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943"), withdrawals[0].Address)
		assert.Equal(t, uint64(1), withdrawals[0].Amount)
	})
	t.Run("not blinded", func(t *testing.T) {
		sbb, err := blocks.NewSignedBeaconBlock(&zond.SignedBeaconBlock{Block: &zond.BeaconBlock{Body: &zond.BeaconBlockBody{}}})
		require.NoError(t, err)
		_, err = (&Client{}).SubmitBlindedBlock(ctx, sbb)
		require.ErrorIs(t, err, errNotBlinded)
	})
}

func testSignedBlindedBeaconBlockCapella(t *testing.T) *zond.SignedBlindedBeaconBlock {
	return &zond.SignedBlindedBeaconBlock{
		Block: &zond.BlindedBeaconBlock{
			Slot:          1,
			ProposerIndex: 1,
			ParentRoot:    ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
			StateRoot:     ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
			Body: &zond.BlindedBeaconBlockBody{
				RandaoReveal: ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505"),
				Zond1Data: &zond.Zond1Data{
					DepositRoot:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					DepositCount: 1,
					BlockHash:    ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
				},
				Graffiti: ezDecode(t, "0xdeadbeefc0ffee"),
				ProposerSlashings: []*zond.ProposerSlashing{
					{
						Header_1: &zond.SignedBeaconBlockHeader{
							Header: &zond.BeaconBlockHeader{
								Slot:          1,
								ProposerIndex: 1,
								ParentRoot:    ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								StateRoot:     ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								BodyRoot:      ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
							},
							Signature: ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505"),
						},
						Header_2: &zond.SignedBeaconBlockHeader{
							Header: &zond.BeaconBlockHeader{
								Slot:          1,
								ProposerIndex: 1,
								ParentRoot:    ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								StateRoot:     ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								BodyRoot:      ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
							},
							Signature: ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505"),
						},
					},
				},
				AttesterSlashings: []*zond.AttesterSlashing{
					{
						Attestation_1: &zond.IndexedAttestation{
							AttestingIndices: []uint64{1},
							Data: &zond.AttestationData{
								Slot:            1,
								CommitteeIndex:  1,
								BeaconBlockRoot: ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								Source: &zond.Checkpoint{
									Epoch: 1,
									Root:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								},
								Target: &zond.Checkpoint{
									Epoch: 1,
									Root:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								},
							},
							Signatures: [][]byte{ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505")},
						},
						Attestation_2: &zond.IndexedAttestation{
							AttestingIndices: []uint64{1},
							Data: &zond.AttestationData{
								Slot:            1,
								CommitteeIndex:  1,
								BeaconBlockRoot: ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								Source: &zond.Checkpoint{
									Epoch: 1,
									Root:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								},
								Target: &zond.Checkpoint{
									Epoch: 1,
									Root:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
								},
							},
							Signatures: [][]byte{ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505")},
						},
					},
				},
				Attestations: []*zond.Attestation{
					{
						ParticipationBits: bitfield.Bitlist{0x01},
						Data: &zond.AttestationData{
							Slot:            1,
							CommitteeIndex:  1,
							BeaconBlockRoot: ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
							Source: &zond.Checkpoint{
								Epoch: 1,
								Root:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
							},
							Target: &zond.Checkpoint{
								Epoch: 1,
								Root:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
							},
						},
						Signatures: [][]byte{ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505")},
					},
				},
				Deposits: []*zond.Deposit{
					{
						Proof: [][]byte{ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2")},
						Data: &zond.Deposit_Data{
							PublicKey:             ezDecode(t, "0x94ef47878aea6c24a6aac5d43465cc361bbaf8bc8c9eba9abccda48977767f5604b8150337fd5ca7cf90bf8f63fca0e6fc0728a3071e5ccae2766a15679d2a57ddc95f6f51ff8bb831aaa937271eb80d599566ae1e73173aad708f68330bbd9c6555c0f9366763011f7aa4edebab101f99a4007c8ae1123a13e7c7cc19e2e7699b549bb770d3753bea49ec9e31104bae89fc38abe75e1f140267a2f492409d25f188aec4783afd2c8140f6a8c6850077536cb2760c65779d165b6f03f9b149210d8160f58803d31171be717baf887aa612c02f806bd9e3332ddc21c0e6e912d053d4d49c13d2de8a75266e6157610175d4897e58886aae12bf7b949e20351d80a4a994e7c70c9ba76a2472818343609061ffa393f6f270dc8b4aa806d5616e55e936f26cccd3e1006bf185196ae5457d224fca6555068bfb64a228e8b44b4221e85d2f1137224992f41a78301ff768527e953e50424a45d21e8877a16a915629f45aba1aca08769c561260d4d58bcf36af98c26e6b81365b91720f3155c1f9383d8c7ab295aabe6c9799f625d29da42bd4002fbd337ceaf991573678f6384da18541c4e3a3c9472620c19129bb41e2b5e71884b98a8ac319a0ec2be11948f4c02b0b824a2347e00945ec89f45f431dfb3605d8228ce69136867570bd0149f4fe2b53f19d1458e7d6f9688af7c5ec3021fbe61cb331a5a44c9f5e9a4a1192d5eeddf98f47e1c8379bf000ae6886cc3eb5442fa8586652550876a4ef31dd941eac082e9fb1ff26db706159ec7be0a5051b408fc955c55335db1f46c6e87113aabb03960f2f4fc986e4e583021b6b69e7c68b0d1093429630cf7f4a7e895ad45a41363c53d0ddce0804a8858092bc7a069852fff02773e0abd6c7cc7d3d34c0bebfb34e1c5e95ddb184c4a0fc77ed09fca96dc472ba0391214c489890ea410085d4c6ecc69f3facf0b1587372752a421641597563fedc9fc64452d7a7a0db9560ec1c8564a3180a5e623b65e1dd494f967556bde56f9bf58cf5e07a050258e4a90cc2700831a4113391877c65ebaadea8710e23ca9f7afb8c5bd90edf38211b32874b65bef5455159c1a1d17ac3da17819f8adcb254a62d7f4c362cc470f75fddaf6f6624f3a56b0187c4e21295534a832a0f2720c411d0685751fff095078d18bc854856f7e1abe14eb76e9e45fd1eca282804784d9c27fd15ab00bb6dbfd864c401f759d0f2da8ad8640b81066038b72c6cf26605f8388cdd67aeca21dda79d6dd01bc3d3ff5ee29f5e016ea681ba581940d0130685d42e9635c6ca27e1eb9fbf08f44879f4f479eefbde7b65476fbe379f771b0f116a2e6e5f65416b72f2c49452c40b2f108ab86ac7dbb8e252ed32946e5be280b512734c96db9511b21eeec3d0caeac51f8ca315ad7dd62efd1113e03932856d5eef73035a0ae24fef22a2c8aa1db28bc87702c34b2d2d722ddf0ad9d2eb4a6c16b85a7e22c49d115c676afeef8f66ec95ec805e4c1423df5dc2eeece55f107005e15b3ded7c5ff7b7d6fd8530049ede7b776bee594fc18e29a4ae177419bfcb2a0185f51ab35c389baf9b37742192e1c36c2ba7d5c46f683dfa8ca8103a824033c68d844d0ed55e560b96b8421162f57e2daaef5853bfe476903fcb42196e78ae2afe3d5da230de9628e2d268dfc50290b2a8ddae0ade58e2919e0f9be4b538220b885e20b28741cce7c6072aa27cf076197d8e046072045f4a4e20058e7ff428419ce7629b7f76dc0568d99586fc4095107b02228d4f2e9978abe68ef302747a67805d0158b88e94bdb73f1c6e1ca8918b311b0a5d101130e142d2085778d1546532c842f2673cb7a3774eb6d23fa901883aaa682aa7ed0195c3f899f6b485e09715a3791ac9102c177b37465344523fef3e9479ce39d358db0106b5b4cfe26415c5ebc2d00ab36af1171ca33f2c95ff16b63f91e10de4405aec7d6368afc20643616bf30505507f7af84a6f70a36c9f6644bf22bb141f88f15c01f99fbb0344b6db03c042cb8e80e6e38717c3e749cae3782b3d3529cbcfd68a04ade376a7f334ea471d21ebbc62035a57cced3f74a1612edb492a13aacc93d51348249451616f01bbd0e89f46fa53acc5490c7164ef8b2ac0a236b9da37f696db7d2e2dd51243966d2deeae418f2edc6f38fabe746ec5bc832db5af6856266c140e78ce15c2699778910c8e002290b52a68bd14c3be294154c7f448be0160d4adc856b307aa4d3a3ec82af0d25d951d25dc2027ed7861c9ef7d0228179a9fd38ba45f8721d6ce3dd42dce8f58f917d3555c04151cae3e0fc761291c632c0f13e618958cda614f7650efd18e1ffed06bc171530b5bde901becb2b021db47e541679bbb55f7337e1d205e1031eb2ef9a332e84bcbd9b5e27682159c86d3031ab01d741fedf1b05a4e1bc82da108855c8d833abb99821c8be81df68818e2aa094a3cde6f3d5e1bd8b2e86daba12aa2b572ffc81c65c3e498432edb00f1fe6fb04ec92a96b2c206a36a5623f8710c06cc20fdc661230f8b441ce4ebfa45a2890a4a43f2dbd498a9ef9d1f4e748ec81bca42a27aa8acd72406ca303050a32aa644f60e1c58a036ca2b0f0ca69092f6d08a40ee97ff700931b87039bdff71043a75b1578b33d98b391ae0dccbd46f5428cc80016412cbce9532b70454ab801c77072249412a2d49e8f608ab7480b1a9416714c825bd07a96641b865daeda71a5bf6b9e28bbf4a9042e79a6d6dd0c1d99dd3cabf4d580b6bc22999acbfb6f25a33e622104c13aa173e2191eb70dd0db82ae47d1ddbbdb24d3d4403bcaa64bcde88c86ce5bd535694b24f117e729abb3582e2166658f969a206b44aa37837c6efd7f094443c65f43b95826aa97ab1d3dc9aa3e56b31b1d2fe5e2eb44d2b5ccb1039118ac3917148fe4dffdc81daac74007ce71dd5e779be416de62b271bc4379e0a24c6c42e8e8c0213dee8588752d54b12b4da7be2e7a75c6b3e8ad9a92a4768d0611bc91ddd4aebda0cfb84226280ce6f621b5a83016b51bc9de2fe0413ce43ff967cf3680c9e1c359316ab207d93382df330b6a1fff25f01506952465fbdc1d36aeb0124b593b29619b712867c63c7e872d65d18b8834c505ff23688bda7b9d4e4969d6b69aae0b5ff14a152191c5f94a061aa3a7db71bc4ad9ce217a931a92b35e6faec8e00800f96b0efe6d42d1edf25573f12da245539f8fba9ab270cf738d585a144d9098e5d529f3e8662903de413ca9174b9bc6da0a70be23cce8b1dd7b0a1db109605f20d3ba5d72d4361e63cdbfe58ba1e19c0cbb0ab65090c8dc30265ac76a191707804756107d14e1ec41b6b8765286f99960fb601394bb1db089bd5ea19f3b98666e003affb6e9477a42f1c836efdb2355ce392849a777a6c4ac9e1eeb7bad57faa0f25eec2adf2d2d3b20e5ad1ce82ffdd9264e90a37a269f24841742479ccfadb38664c503191da287b16ca59d06b0ebb09e658cc0090665d8ca90b917c4a089b9474b9d76ba7d9deeb96f9a82ed10365d756da05f23bc9f81222b09e5d4b490977052f0bdd3afacd28b2f6730b3a6784eff8653fc8dcca5d17f7c34b05a30cf939ca10c52b714a5ab51b77b523917963a9f3374c7004b81588e06103615fb793dc267e8e3677d8fed75cb371"),
							WithdrawalCredentials: ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
							Amount:                1,
							Signature:             ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505"),
						},
					},
				},
				VoluntaryExits: []*zond.SignedVoluntaryExit{
					{
						Exit: &zond.VoluntaryExit{
							Epoch:          1,
							ValidatorIndex: 1,
						},
						Signature: ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505"),
					},
				},
				SyncAggregate: &zond.SyncAggregate{
					SyncCommitteeSignatures: make([][]byte, 512),
					SyncCommitteeBits:       bitfield.Bitvector512{0x01},
				},
				ExecutionPayloadHeader: &v1.ExecutionPayloadHeader{
					ParentHash:       ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					FeeRecipient:     ezDecode(t, "0xabcf8e0d4e9587369b2301d0790347320302cc09"),
					StateRoot:        ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					ReceiptsRoot:     ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					LogsBloom:        ezDecode(t, "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"),
					PrevRandao:       ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					BlockNumber:      1,
					GasLimit:         1,
					GasUsed:          1,
					Timestamp:        1,
					ExtraData:        ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					BaseFeePerGas:    []byte(strconv.FormatUint(1, 10)),
					BlockHash:        ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					TransactionsRoot: ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
					WithdrawalsRoot:  ezDecode(t, "0xcf8e0d4e9587369b2301d0790347320302cc0943d5a1884560367e8208d920f2"),
				},
			},
		},
		Signature: ezDecode(t, "0x1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505cc411d61252fb6cb3fa0017b679f8bb2305b26a285fa2737f175668d0dff91cc1b66ac1fb663c9bc59509846d6ec05345bd908eda73e670af888da41af171505"),
	}
}

func TestRequestLogger(t *testing.T) {
	wo := WithObserver(&requestLogger{})
	c, err := NewClient("localhost:3500", wo)
	require.NoError(t, err)

	ctx := context.Background()
	hc := &http.Client{
		Transport: roundtrip(func(r *http.Request) (*http.Response, error) {
			require.Equal(t, getStatus, r.URL.Path)
			return &http.Response{
				StatusCode: http.StatusOK,
				Body:       io.NopCloser(bytes.NewBufferString(testExampleExecutionPayload)),
				Request:    r.Clone(ctx),
			}, nil
		}),
	}
	c.hc = hc
	err = c.Status(ctx)
	require.NoError(t, err)
}
