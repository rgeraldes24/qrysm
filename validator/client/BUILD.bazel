load("@qrysm//tools/go:def.bzl", "go_library", "go_test")

go_library(
    name = "client",
    srcs = [
        "aggregate.go",
        "attest.go",
        "attest_protect.go",
        "key_reload.go",
        "log.go",
        "metrics.go",
        "multiple_endpoints_grpc_resolver.go",
        "propose.go",
        "propose_protect.go",
        "registration.go",
        "runner.go",
        "service.go",
        "sync_committee.go",
        "validator.go",
        "wait_for_activation.go",
    ],
    importpath = "github.com/theQRL/qrysm/validator/client",
    visibility = [
        "//cmd:__subpackages__",
        "//validator:__subpackages__",
    ],
    deps = [
        "//api/grpc",
        "//async",
        "//async/event",
        "//beacon-chain/builder",
        "//beacon-chain/core/altair",
        "//beacon-chain/core/signing",
        "//cache/lru",
        "//cmd/validator/flags",
        "//config/features",
        "//config/fieldparams",
        "//config/params",
        "//config/validator/service",
        "//consensus-types/blocks",
        "//consensus-types/interfaces",
        "//consensus-types/primitives",
        "//crypto/hash",
        "//crypto/ml_dsa_87",
        "//crypto/rand",
        "//encoding/bytesutil",
        "//monitoring/tracing",
        "//proto/qrysm/v1alpha1",
        "//proto/qrysm/v1alpha1/slashings",
        "//proto/qrysm/v1alpha1/validator-client",
        "//runtime/version",
        "//time",
        "//time/slots",
        "//validator/accounts/iface",
        "//validator/accounts/wallet",
        "//validator/client/beacon-chain-client-factory",
        "//validator/client/iface",
        "//validator/client/node-client-factory",
        "//validator/client/validator-client-factory",
        "//validator/db",
        "//validator/db/kv",
        "//validator/graffiti",
        "//validator/helpers",
        "//validator/keymanager",
        "//validator/keymanager/local",
        "@com_github_dgraph_io_ristretto//:ristretto",
        "@com_github_golang_protobuf//ptypes/empty",
        "@com_github_golang_protobuf//ptypes/timestamp",
        "@com_github_grpc_ecosystem_go_grpc_middleware//:go-grpc-middleware",
        "@com_github_grpc_ecosystem_go_grpc_middleware//retry",
        "@com_github_grpc_ecosystem_go_grpc_middleware//tracing/opentracing",
        "@com_github_grpc_ecosystem_go_grpc_prometheus//:go-grpc-prometheus",
        "@com_github_hashicorp_golang_lru//:golang-lru",
        "@com_github_pkg_errors//:errors",
        "@com_github_prometheus_client_golang//prometheus",
        "@com_github_prometheus_client_golang//prometheus/promauto",
        "@com_github_sirupsen_logrus//:logrus",
        "@com_github_theqrl_go_bitfield//:go-bitfield",
        "@com_github_theqrl_go_zond//common",
        "@com_github_theqrl_go_zond//common/hexutil",
        "@io_opencensus_go//plugin/ocgrpc",
        "@io_opencensus_go//trace",
        "@org_golang_google_grpc//:go_default_library",
        "@org_golang_google_grpc//codes",
        "@org_golang_google_grpc//credentials",
        "@org_golang_google_grpc//metadata",
        "@org_golang_google_grpc//resolver",
        "@org_golang_google_grpc//status",
        "@org_golang_google_protobuf//proto",
        "@org_golang_google_protobuf//types/known/emptypb",
    ],
)

go_test(
    name = "client_test",
    size = "small",
    srcs = [
        "aggregate_test.go",
        "attest_protect_test.go",
        "attest_test.go",
        "key_reload_test.go",
        "metrics_test.go",
        "propose_protect_test.go",
        "propose_test.go",
        "registration_test.go",
        "runner_test.go",
        "service_test.go",
        "slashing_protection_interchange_test.go",
        "sync_committee_test.go",
        "validator_test.go",
        "wait_for_activation_test.go",
    ],
    data = [
        #"@eip3076_spec_tests//:test_data",
    ],
    embed = [":client"],
    deps = [
        "//async/event",
        "//beacon-chain/core/signing",
        "//cache/lru",
        "//config/features",
        "//config/fieldparams",
        "//config/params",
        "//config/validator/service",
        "//consensus-types/blocks",
        "//consensus-types/blocks/testing",
        "//consensus-types/interfaces",
        "//consensus-types/primitives",
        "//consensus-types/validator",
        "//crypto/ml_dsa_87",
        "//crypto/ml_dsa_87/common/mock",
        "//encoding/bytesutil",
        "//proto/qrl/service",
        "//proto/qrysm/v1alpha1",
        "//proto/qrysm/v1alpha1/validator-client",
        "//runtime",
        "//testing/assert",
        "//testing/mock",
        "//testing/require",
        "//testing/util",
        "//testing/validator-mock",
        "//time",
        "//time/slots",
        "//validator/client/iface",
        "//validator/client/testutil",
        "//validator/db/testing",
        "//validator/graffiti",
        "//validator/keymanager",
        "//validator/keymanager/local",
        "@com_github_golang_mock//gomock",
        "@com_github_golang_protobuf//ptypes/empty",
        "@com_github_pkg_errors//:errors",
        "@com_github_sirupsen_logrus//:logrus",
        "@com_github_sirupsen_logrus//hooks/test",
        "@com_github_stretchr_testify//mock",
        "@com_github_theqrl_go_bitfield//:go-bitfield",
        "@com_github_theqrl_go_zond//common",
        "@com_github_theqrl_go_zond//common/hexutil",
        "@in_gopkg_d4l3k_messagediff_v1//:messagediff_v1",
        "@org_golang_google_grpc//codes",
        "@org_golang_google_grpc//metadata",
        "@org_golang_google_grpc//status",
        "@org_golang_google_protobuf//types/known/emptypb",
    ],
)
